Theoretical approaches to x-ray absorption fine structure

I. INTRODUCTION
X-ray absorption fine structure (XAFS) refers to the oscillatory structure in the x-ray absorption coefficient just above an x-ray absorption edge. This turns out to be a unique signature of a given material; it also depends on the detailed atomic structure and electronic and vibrational properties of the material. For this reason, XAFS is a very important probe of materials, since knowledge of local atomic structure, i.e., the species of atoms present and their locations, is essential to progress in many scientific fields, whether for biology, chemistry, electronics, geophysics, metallurgy, or materials science. However, extracting this information with precision in the often complicated, aperiodic materials of importance in modern science and technology is not easy, even with the subtle and refined experimental techniques currently available.
Over the past three decades the technique of XAFS has made great strides toward the goal of providing such information. The existence of intense new synchrotron x-ray sources alone was not enough to achieve this goal, even though such facilities spurred considerable progress. In addition, the full success of the XAFS technique must be attributed in large part to advances in theory, which have led ultimately to a highly quantitative understanding of the phenomena. The purpose of this article is to review these advances, many of which have taken place only within the last decade. We focus primarily on extended XAFS (EXAFS), the fine structure in the absorption well above an x-ray edge, which is now largely understood in terms of a high-order multiple-scattering theory. To a lesser extent, we also discuss progress in understanding the fine structure close to an edge, i.e., the x-ray absorption near-edge structure (XANES), from the same unified one-particle, multiplescattering viewpoint. However, the theory of XANES is not as yet fully quantitative and requires different physical considerations. Although this field is the subject of many current investigations, a complete understanding remains elusive. Therefore this review is generally restricted to the regime where the multiple-scattering expansion can be assumed to be convergent and the theory is well established. This region typically begins several eV or more above an absorption edge. Earlier reviews of the field are given, for example, by Lee et al. (1981), and in Koningsberger and Prins (1988). We begin with a summary of the fundamental physics of x-ray absorption and a brief historical review of the theory in this field. We then summarize the key ideas and outline the content of the remainder of this review.

A. X-ray absorption
X-ray absorption spectroscopy measures the absorption of x rays as a function of x-ray energy Eϭប. More specifically, the x-ray absorption coefficient (E)ϭ Ϫd ln I/dx is determined from the decay in the x-ray beam intensity I with distance x (Fig. 1). If the absorption coefficient is plotted as a function of E (Fig. 2), the experimental data show three general features: (1) an overall decrease in x-ray absorption with increasing energy; (2) the presence of a sharp rise at certain energies called edges, which roughly resembles step-function in-creases in the absorption; and (3) above the edges, a series of wiggles or oscillatory structure that modulate the absorption, typically by a few percent of the overall absorption cross section.
The first feature is illustrative of the well-understood quantum-mechanical phenomenon of x-ray absorption by atoms, as described, for example, by Fermi's ''golden rule'' in standard texts (e.g., Messiah, 1966). The energy position of the second feature is unique to a given absorption atom and reflects the excitation energy of inner-shell electrons. The third feature is the XAFS that is of primary interest in this review. When interpreted correctly, this feature contains detailed structural information, such as interatomic distances and coordination numbers. The XAFS spectrum is defined phenomenologically as the normalized, oscillatory part of the x-ray absorption above a given absorption edge, i.e.,

͑E ͒ϭ͓͑ E ͒Ϫ
where 0 (E) is the smoothly varying atomic-like background absorption (including contributions, if any, from other edges), and ⌬ 0 is a normalization factor that arises from the net increase in the total atomic background absorption at the edge in question. In practice, this normalization factor is often approximated by the magnitude of the jump in absorption at the edge. The error in this approximation can be accounted for by a small (typically about 10%) correction to the XAFS Debye-Waller factor, which is called the McMaster correction (see Sayers and Bunker, 1988). Each absorption edge is related to a specific atom present in the material and, more specifically, to a quantum-mechanical transition that excites a particular atomic core-orbital electron to the free or unoccupied continuum levels (ionization of the core orbital). The nomenclature for x-ray absorption reflects this origin in the core orbital (Fig. 3). For example, K edges refer to transitions that excite the innermost 1s electron. The transition is always to unoccupied states, i.e., to states with a photoelectron above the Fermi energy, which leaves behind a core hole. The resulting excited electron is often referred to as a photoelectron and in a solid generally has enough kinetic energy to move freely through the material. This occurs even in insulators, FIG. 1. Schematic view of x-ray absorption. I 0 is the intensity of the incoming x-ray beam, which has a cross-sectional dimension (width) a. Inside the slab of absorbing material (of total depth x), the intensity is i, and there is a loss of intensity dI in each infinitesimal slab of the material dx. After the x ray has traversed a distance x into the slab, the intensity has been reduced to IϭI 0 e Ϫx , where is the definition of the absorption coefficient. This figure was redrawn; it is based on  since the excited states are almost always extended states (quasifree states in molecules and conductionband states in solids). The energies of the edges (or ionization energies) are unique to the type of atom that absorbs the x ray, and hence themselves are signatures of the atomic species present in a material.
The generally weak oscillatory wiggles (Fig. 4) beyond about 30 eV above the absorption edge were eventually termed EXAFS (extended x-ray absorption fine structure) by Prins and Lytle (Lytle, 1965); see Lytle (1999) for a discussion of the history of this nomenclature. As noted above, this fine structure contains precise information about the local atomic structure around the atom that absorbed the x ray. In contrast, the region closer to an edge is often dominated by strong scattering processes as well as local atomic resonances in the x-ray absorption and is generally not as readily interpreted as EXAFS. This region of strong scattering is referred to as the x-ray absorption near-edge structure, or XANES, and typically lies within the first 30 eV of the edge position. The more general term XAFS was introduced by Rehr et al. (1986) to refer to the fine structure in both XANES and EXAFS, following the recognition that they both have a common origin, namely, the scattering of a photoelectron by its environment.

B. Early history of XAFS
Roughly 70 years have elapsed since the phenomenon of EXAFS was first observed, and it has taken nearly that long to realize that accurate, detailed, structural information could be extracted from it and to develop a quantitative theory. Early progress was impeded by experimental limitations of the then available x-ray sources. For recent historical reviews, see, for example, Lytle (1999) and Stumm von Bordwehr (1989). Moreover, the theoretical interpretation was also not clear cut at that time. This is not surprising, since a full treatment turns out to depend on many complicated details of atomic and molecular structure, high-energy electronatom scattering, many-electron processes, vibrational structure, and disorder. Indeed, much of this physics has only been unraveled within the past 30 years, and a fully quantitative theory was not developed until the present decade. Remarkably, many of the developments needed to explain EXAFS are complementary to advances in our understanding of ground-state electronic structure, e.g., the development of the density-functional formalism (Kohn and Sham, 1965) for band-structure calculations or low-energy excited states. Unfortunately, however, many of these modern electronic-structure codes, such as, for example, the linear muffin-tin orbital code of Andersen (1975; see also Skriver, 1984) or the fullpotential linear augmented plane-wave codes (e.g., Blaha et al., 1997), are not completely applicable at the high energies typically encountered in XAFS (i.e., they require additional modifications, such as hugely expanded basis sets and an energy-dependent exchangecorrelation potential; see Sec. III.B.1).
In the early years, the precise origin of EXAFS was controversial (Parratt, 1959;Azaroff, 1963;Lytle, 1999). From general principles of quantum-mechanical transition rates, it was expected that x-ray absorption should be governed by the Fermi ''golden rule'' in terms of a squared transition matrix element times a density of FIG. 3. The relationship between the x-ray absorption edges and the corresponding excitation of core electrons. Shown are the excitations corresponding to the K, L, and M x-ray absorption edges. The arrows show the threshold energy difference of each edge. Any transitions higher in energy (to unoccupied states above the Fermi energy E F ) are also allowed. This figure was redrawn; it is based on Fig. 1 of Grunes (1983). FIG. 4. The relationship between the x-ray absorption coefficient (E), the smooth atomiclike background 0 (E), and (E) for a Cu K edge. Usually is plotted as a function of k.
Here the x axis for the plot has been converted to energy units to make it consistent with the other plots. The values for have been multiplied by a factor of 3 relative to the (E) plot to make it show up better. Notice that oscillates around zero.
states for available energy levels. Kronig (1931) originally interpreted the XAFS oscillations in crystals as a density-of-states effect, due to the strong diffraction of electrons by the crystal lattice, the so-called long-rangeorder theory. However, the very fine structure present in the density of states due to long-range Bragg scattering, e.g., the sharp van Hove-type peaks observed in bandstructure calculations, is generally much too detailed to explain the observed EXAFS, and attempts to match EXAFS peaks with predictions of long-range-order theories proved unsatisfactory. Shortly thereafter, Kronig presented an alternative theory for small molecules, in which the oscillatory structure in EXAFS was attributed to the influence of neighboring atoms on the transition matrix element in the golden rule, i.e., a shortrange-order effect (Kronig, 1932). This type of theory is most often used today to explain the origin of XAFS, although, as we shall see later, both long-and shortrange-order theories can be reconciled when appropriate broadening is introduced.
The short-range-order theory reflects the quantummechanical wavelike nature of the final, excited, photoelectron state. That is, the dominant wiggles in the XAFS spectrum are interpreted as a quantuminterference phenomenon. The outgoing photoelectron can be viewed as a quantum wave that spreads out over the solid, much as a rock thrown in a pond creates an expanding spherical wave in water. In the same way that water waves reflect off of any obstacles in the pond and, in turn, reflect other waves back toward the original point of the splash, so will other atoms reflect the electron wave back towards the original atom (see Fig. 5). The amplitude of all the reflected electron waves at the absorbing atom add either constructively or destructively to the outgoing photoelectron wave and hence modulate the matrix element between the initial and final states that controls the strength of the transition. Because this interference pattern changes with the energy of the photoelectron (note that the de Broglie wavelength of the electron wave varies inversely with the wave vector k or momentum of the electron), the matrix element, and consequently the absorption, will exhibit similar oscillations.
The modern resolution to the controversy between the short-and long-range-order approaches lies in the energy-dependent competition between scattering strength and inelastic losses. A crucial element is the recognition that a high-energy, excited photoelectron state is not infinitely long lived, but must decay as a function of time and distance and hence cannot probe long-range effects. This decay is due primarily to inelastic losses (i.e., ''extrinsic losses'') as it traverses the material, either by interacting with and exciting other electrons in the solid, or by creating collective excitations (e.g., losing energy to plasmon production). In addition, the intrinsic lifetime of the core-hole state (i.e., ''intrinsic losses'') must be considered. In phenomenological terms, the original outgoing wave of the excited photoelectron dies away as it moves further away from the absorbing atom. Ultimately it becomes too weak to significantly reflect any waves off of distant atoms. The returning reflected waves also suffer this same type of extinction. The net effect is that XAFS can only measure the local atomic structure over a range limited by the net lifetime (or effective mean free path) of the excited photoelectron. This range is typically on the order of tens of angstroms or an inverse lifetime of a few eV and roughly follows a universal dependence (see, for example, Seah and Dench, 1979). The short-range-order theory focuses on this short-range interference between several important scattering paths.
The long-range-order theory, on the other hand, emphasizes the density of states of the extended, excitedstate, energy levels of the entire material, which can be important at low energies or for strong scattering. Indeed, such an approach is often needed for descriptions of ground-state electronic structure, for example, by band-structure codes. However, as we shall discuss later on, properly broadening the results of this type of approach with the inelastic losses and lifetime considerations in effect washes out the fine structure in the spectra due to the long-range nature of the energy states, thereby recovering the results of short-range-order theory at sufficiently high energies. As noted above, the core hole that is left behind by the excited electron (see Fig. 3) also has a finite lifetime, since higher-lying atomic electrons can make transitions to fill this core hole (either directly, by falling into the orbital and emitting photons as radiative transitions, or indirectly in two-electron nonradiative Auger transitions). Through the uncertainty principle, any state with a finite lifetime does not have a sharp (or delta-function-like) energy level, but is better thought of as having a finite width, e.g., a Lorentzian line shape. In practice, these intrinsic losses lead to an additional broadening of the spectrum and dominate the effective mean free path at threshold. Core widths can be as large as several eV for the deeper core states of heavy atoms, but are relatively small (of the order of 0.1 eV) for light atoms and shallow transitions, compared to the effective widths due to extrinsic losses (typically about 5 eV). Indeed, residual long-range effects often persist, especially in materials with long lifetimes and strong scattering.

C. Structural information in XAFS
It was only in the early 1970s, following the pioneering work of Sayers, Stern, and Lytle (1971), that it was widely recognized that these interference patterns or wiggles in the XAFS spectra could be used to obtain quantitative information about the local structure near an absorbing atom from a short-range-order theory. This wiggly structure has embedded within it information about near-neighbor distances, coordination numbers, and fluctuations in bond distances. The main obstacle to extracting this information is the necessity of an accurate theoretical model or an experimental reference compound to calibrate the measurements. Theoretical models are actually preferable, since experimental references are not generally useful beyond the first coordination shell and often are not readily available. Fortunately, such theoretical models for XAFS are now comparable in accuracy to experimental reference materials, and they are available throughout the periodic table; their development was due to many theoretical advances (for reviews, see, for example, Lee et al., 1981 andKoningsberger andPrins, 1988) that have been fostered and tested by precision experiments over the past three decades using modern high-intensity synchrotronradiation sources. In particular, an accurate, general, theoretical treatment has emerged during the past several years. Thus it now appears that the phenomenon of XAFS in the extended regime (EXAFS), beyond about 20-30 eV from an edge, is generally well understood (Rehr et al., 1992;Zabinsky et al., 1995; see also Binsted et al., 1987, andFilipponi et al., 1995), albeit within acceptable tolerances. This degree of knowledge is sufficient to make the XAFS technique reliable for experimental structure determinations accurate to about 0.02 Å or better.
The needed theoretical developments did not all come at once, but through a series of continual refinements that were incorporated one by one. To give an overview of these developments it is useful to review the heuristic treatment of XAFS, starting with the more precise, semi-phenomenological treatment of Stern et al. (1975), which led to the now standard EXAFS formula.
First, we summarize the main physical quantities of interest. The x-ray absorption coefficient (E), which is the attenuation of the x-ray beam per unit distance, is a strong function of x-ray energy Eϭប and exhibits abrupt jumps at ''absorption edges,'' i.e., the thresholds បϭ͉E c ͉ for photoexcitation of electrons from deep atomic core levels E c . If the x-ray photon has an energy higher than the threshold energy E c , the extra energy is taken up by the excited photoelectron as a higher kinetic energy. In order to separate the structural information from the energy dependence of the absorption cross sections, the normalized XAFS spectrum (see Fig. 4) is usually defined as the normalized oscillatory part of , as in Eq. (1). Conventionally, is often defined with respect to the ''photoelectron momentum index'' k ϭͱបϪ͉E c ͉, as measured from threshold, i.e., one defines (k) rather than (E) on an absolute energy scale. Note too that this definition of k differs from the physical momentum p in a solid, which reduces to the Fermi momentum k F at threshold. Often the normalization constant ⌬ 0 is taken to be the jump in absorption 0 at the edge (edge-jump normalization), but more precisely it should be considered as a function of energy in order to make contact with theory, as discussed below. The quantity 0 is the relatively smooth, atomic-like, background absorption of an ''embedded atom,'' in the absence of neighboring scatterers (see Fig. 4). This is the absorption that would, in principle, be measured from a modified atom, as it exists in a condensed material, if one could turn off all the interference by the reflected waves from the neighboring atoms; it thus differs from that of a free atom.
According to the Fermi golden rule, the x-ray absorption coefficient is proportional to a transition matrix element squared. For highly localized core electrons the transition matrix element is proportional to the probability ͉ k (r)͉ 2 that the photoelectron is found at the atom where the photon is absorbed. (Typically, the core orbitals are of size 1/Z in Bohr units, where Z is the atomic number. Throughout this paper we shall generally use atomic units eϭបϭmϭ1 in theoretical formulas; however, experimental distances will generally be given in Å and energies in eV.) The total wave k can be expressed in terms of an outgoing wave emitted at the absorbing atom plus incoming waves that are scattered back by neighboring atoms (see Fig. 5). For a wave reflected straight back by a neighboring shell of atoms, the phase difference between these components is approximately 2kR, where R is the distance to the shell of atoms and kϳ1/ is the photoelectron wave number, being the de Broglie wavelength. Thus decreases with increasing energy, and the modulation in arises from the alternating constructive and destructive interference between these components as the photon energy is varied. The amount of interference also depends on the strength of the reflection from the neighboring atoms (the backscattering amplitude) and the number of scatterers.
The validity of the Kronig short-range-order theory was largely substantiated by Sayers et al. (1971), who developed a quantitative parametrization of EXAFS that has become the standard for much current work:
Here the structural parameters are the interatomic distances R, the coordination number (or number of equivalent scatterers) N R , and the temperaturedependent rms fluctuation in bond length , which should also include effects due to structural disorder. In addition, f(k)ϭ͉f(k)͉e i⌽(k) is the backscattering amplitude, ␦ c is central-atom partial-wave phase shift of the final state, and (k) is the energy-dependent XAFS mean free path (not to be confused with the de Broglie wavelength). Although the overall amplitude factor S 0 2 did not appear in the original formula, we have added it here for completeness, since the resulting equation can be obtained from a more detailed many-body theory discussed below (Sec. II.C), provided the terms are appropriately renormalized. Moreover, although the original EXAFS formula referred only to single-scattering contributions from neighboring shells of atoms, the same formula can be generalized (Rehr and Albers, 1990) to represent the contribution from N R equivalent multiplescattering contributions of path length 2R as outlined below. Thus we shall refer to Eq. ( 2) as the standard XAFS formula.
In a very transparent and simple form, this formula contains all of the key elements that a correct theory must have and also provides a convenient parametrization for fitting the local atomic structure around the absorbing atom to the experimental EXAFS data. Most of the eventual improvements of the theory can be viewed as successive refinements of these key elements. The dependence of the oscillatory structure on interatomic distance and energy is clearly reflected by the sin(2kR) term. The decay of the wave due to the mean free path or finite lifetime (including core-hole lifetime) of the photoelectron is captured by the exponential term e Ϫ2R/ . This factor is largely responsible for the relatively short range (generally a few tens of Å) in a material probed by EXAFS experiment. The strength of the reflected interfering waves depends on the type and number of neighboring atoms through the backscattering amplitude ͉f(k)͉ [Fig. 6(a)], and hence is primarily responsible for the magnitude of the EXAFS signal. Other factors, namely, the spherical-wave factors 1/kR 2 and mean-free-path terms, are secondary but important for a quantitative behavior of the EXAFS amplitude. The phase factor ⌽ϭarg f(k) [Fig. 6(b)] reflects the quantum-mechanical wavelike nature of the backscattering. A somewhat larger contribution to the overall phase is given by the phase shift ␦ c at the absorbing atom, since the photoelectron sees the potential created by this atom twice. These phase shifts account for the difference between the measured and geometrical interatomic distances, which is typically a few tenths of an Å and must be corrected by either a theoretical or an experimental reference standard (see Fig. 7).
Another effect that we have not yet discussed is the Debye-Waller factor, which is given to a good approximation by e Ϫ2 2 k 2 . This factor is due partly to thermal effects, which cause all of the atoms to jiggle around their equilibrium atomic positions. These slight movements smear the sharp interference pattern of the rap-idly varying sin(2kR) term that would be seen if the atoms were unmoving (Fig. 8). Effects of structural disorder are similar, and they give an additive contribution to 2 . This Debye-Waller effect becomes more pronounced the shorter the wavelength of the photoelectron, and hence it cuts off the EXAFS at sufficiently large energy beyond about kϳ1/, which is typically of order 10 Å Ϫ1 . Thus the Debye-Waller factor is essential in EXAFS, but is often negligible in XANES, when 2 k 2 Ӷ1. Moreover, since 2 generally increases with temperature T (the vibrations become larger at higher temperatures), the EXAFS tends to ''melt'' at high temperatures, being confined to successively lower regions of energy. Finally, the overall amplitude factor S 0 2 is a many-body effect due to the relaxation of the system in FIG. 6. Comparison of the k dependence of the effective backscattering amplitude ͉f eff (,R)͉ evaluated at R nn ϭ2.55 Å (solid line) and for comparison the result for the plane-wave approximation (long dashes), which is equivalent to setting Rϭϱ. The dotted line, which is the k dependence of the amplitude evaluated at 2R nn , illustrates the approximate linear dependence of f eff on 1/R. The angle indicates that the amplitude is for scattering the wave directly backwards (at 180 degrees). This is the relevant amplitude for conventional single-scattering EX-AFS. Part (a) gives the magnitude of f eff and part (b) its phase. This figure was redrawn; it is based on Fig. 1 of Rehr et al. (1986).
response to the creation of the core hole. Although S 0 2 is weakly energy dependent, it is usually approximated by a constant. A fully quantitative theory has yet to be developed.
The inclusion of inelastic losses and Debye-Waller factors was crucial to the success of the modern short-range-order theory of XAFS. Moreover, using the representation of EXAFS given by Eq. ( 2), Sayers et al. (1971) showed that a Fourier transform of the XAFS with respect to k corresponds to an effective radial distribution function, with peaks near the first few nearneighbor distances. This important observation paved the way for using EXAFS as a general probe of microscopic structural information in molecules and solids. The technique is especially important in noncrystalline materials, where lattice methods like x-ray diffraction can be inapplicable. Conversely, the validity of the longrange-order theory depends on the absence or weakness of these decay factors.
A key development has been the development of an accurate treatment of scattering by taking curved-wave effects into account. A simplification made in early work is the approximate treatment of the shape of the electron waves. At large distances from the center of a wave, the curvature of a spherical wave front lessens, and it becomes more and more plane-wave-like. The mathematics of the scattering of plane waves is considerably simpler than that of curved waves and can be treated by a plane-wave scattering amplitude f(k). This approximation, which is sometimes called the plane-wave approximation, was originally used to derive the simple result of Eq. (2). A more precise treatment of the planewave approximation was later given by Lee and Pendry (1975), which identified two contributions. One is the ''small-atom'' or ''point-scattering approximation,'' namely, the use of plane-wave scattering amplitudes, and the second is the ''small-wavelength approximation,'' which approximates the Hankel-function behavior of the outgoing spherical wave as simple exponentials. At low energies or short distances, where the FIG. 7. Filtered total XAFS phase (2␦ c ϩ⌽) for the first coordination shell of Cu, Pt, and GeCl 4 from FEFF (solid curves) and from similarly filtered experimental data (dashed curves). This figure was redrawn; it is based on Fig. 3 of Rehr et al. (1991). curvature is more pronounced, it is especially important to remove the second approximation. This is fairly easy to do at the single-scattering level. Indeed, some early work (Sayers et al., 1971) was based on the ''pointscattering approximation,'' although that alone is insufficient to correct the theory. Subsequently, fast and accurate single-scattering, curved-wave theories were developed (Mu ¨ller and Schaich, 1983), but at the expense of a somewhat more complex mathematical treatment. Later it was shown (Rehr et al., 1986;Rehr and Albers, 1990) that the entire theory, including multiplescattering terms, can be recast exactly as in the standard EXAFS equation, but with an effective scattering amplitude f eff (k,R) replacing the plane-wave scattering amplitude (Fig. 6). A similar result is implicit in the formulation of Lee and Pendry (1975) in terms of a scattering factor Z. Moreover, a simplified but accurate, asymptotic, spherical wave approximation for f eff was developed (Rehr et al., 1986), which explains the physical origin of curved-wave effects in terms of an additional phase shift in each partial wave of exp͓Ϫl (l ϩ1)/2kR 2 ͔. Tables of curved-wave phases and amplitudes were also calculated and made available (McKale et al., 1986;Rehr et al., 1991), thus improving on the plane-wave phases and amplitudes (Teo and Lee, 1979).

D. Multiple scattering
Another key development in the theory is that of an accurate treatment of multiple-scattering effects. One obvious weakness of the phenomenological EXAFS theory is that it takes into account only the simplest, but usually the most dominant, form of scattering, i.e., reflections by neighboring atoms directly back to the absorbing atom (this type of scattering is often called ''backscattering'' or ''single scattering''). More generally, atoms can reflect the electron wave onto other atoms that then reflect off of still other atoms (Fig. 5). Such multiple scattering is now known to be essential for accurate calculations of the absorption coefficient in most materials. In particular, multiple scattering by atoms along a linear path, the so-called focusing or shadowing effect, can exceed the backscattering contributions in magnitude (Lee and Pendry, 1975). The beauty of the formulation of Sayers et al. (1971) is that a Fourier transform made it possible to filter the contributions to the absorption by a path-length criterion. For example, if the scattering observed in the transform involved the shortest path length (twice the nearestneighbor distance), backscattering was the only possible type of scattering that contributed significantly, and hence Eq. (2) was essentially correct in this respect, except for small corrections due to the leakage of longerdistance contributions into the first-shell signal. However, in order to reliably extract more general atomicstructure information beyond nearest-neighbor bond distances, it has proved crucial to include multiplescattering effects, as we discuss below.
The formal multiple-scattering theory (Beeby, 1964) of XAFS has been derived based on both the Green's-function method (Schaich, 1973;Ashley and Doniach, 1975) and the wave-function approach (Lee and Pendry, 1975). The pioneering EXAFS theory paper by Lee and Pendry (1975) showed that the two approaches were equivalent and gave the first quantitative treatment of both backscattering and multiple-scattering effects. It was also found that the much simpler plane-wave approximation for the backscattering terms, together with an ad hoc inner potential shift, could be a fairly good approximation at high energies (Lee et al., 1981). However, Rehr et al. (1986) showed that curved-wave corrections are actually important at all energies and introduced an asymptotic spherical wave approximation, which largely accounted for the main curved-wave effects in backscattering. The plane-wave approximation also simplifies multiple-scattering calculations, as shown by Lee and Pendry (1975), but the results generally contain significant errors both in phase and in amplitude. While somewhat better, the spherical wave approximation also proved to be unsatisfactory in a fully quantitative theory. Unfortunately, since Clebsch-Gordan coefficients proliferate for higher-order scattering, an exact treatment of curved-wave contributions based on angular momentum algebra (Messiah, 1966) is computationally demanding and was a major bottleneck in the development of precise theoretical calculations. Despite these difficulties, analytical curved-wave theories were subsequently developed for up to third-order multiple scattering (i.e., four-leg paths; Gurman et al., 1986). Iterative methods for going to even higher order were developed by Natoli and collaborators (Brouder et al., 1989). However, these methods are all generally limited to small clusters or low energies due to the large angular momenta and consequent complexity of the calculations. Moreover, the inclusion of thermal vibrations and disorder in such ''exact'' methods is nontrivial without approximations such as an average only over the exponential dependence ͗e ikR ͘ for a given path length R. For these reasons, neither the plane-wave approximation, the spherical wave approximation, nor exact methods provide practicable schemes for accurate multiplescattering calculations of EXAFS much beyond the first coordination shell.
A strategy that overcomes all of these computational problems was developed by the present authors (Rehr and Albers, 1990). This method is based on a rapidly convergent separable representation of the electron propagator, which permits fast, accurate calculations of any multiple-scattering path. However, the calculations were then limited by a second problem, the exponential proliferation of multiple-scattering paths of increasing length. Fortunately, the overwhelming majority of such paths turn out to have negligible amplitude and can be eliminated with efficient multiple-scattering path filters and a fast path-generation and sorting algorithm developed by Zabinsky et al. (1995). The implementation of these algorithms into the ab initio EXAFS codes known as FEFF-named after the effective scattering amplitude f eff in the theory-now makes accurate, high-order, multiple-scattering calculations of XAFS in general ma-terials routine. Due to the success of this prescription, the multiple-scattering formulation of EXAFS can now be regarded as a well-understood problem, although the treatment of inelastic losses and disorder should be improved. This and other approaches will be reviewed in greater depth later in the paper.

E. Other improvements
Yet another key improvement to early EXAFS theories came with the replacement of the phenomenological mean-free-path term by ab initio theoretical calculations of inelastic losses (Lee and Beni, 1977). This treatment was based on the complex, energy-dependent, electrongas self-energy of Hedin and Lundqvist (1971) in the local-density approximation. This development also replaced the ground-state exchange models by an energydependent exchange potential more appropriate for excited states. The use of a complex, energy-dependent self-energy provides a more accurate, system-dependent description of the damping of the electronic waves in a material. However, it also complicates the theory, since the one-electron Hamiltonian is then non-Hermitian and requires complex phase shifts. Although the Hedin-Lundqvist model usually leads to excessive loss in the XANES regime (Tyson et al., 1992;Zabinsky et al., 1995;Roy and Gurman, 1999), it is generally quite reliable for EXAFS. Tables of atomic EXAFS phase shifts and plane-wave scattering amplitudes based on the Hedin-Lundqvist model of inelastic losses (Teo and Lee, 1979) served as the original theoretical XAFS standards for many years. The Hedin-Lundqvist model continues to be the most widely used self-energy for XAFS calculations.
Perhaps the most pervasive and important influence of all of the improvements to the phenomenological short-range-order theory was the development of fast ab initio computer codes for the calculation of EXAFS, together with the ready availability of faster computers. Such ab initio codes replace the need for tables and give a more accurate treatment of the local environment than free-atom approximations on which the tables were based. Most of these codes now include multiplescattering effects, which are important for treating the EXAFS beyond the first coordination shell. For example, the earliest such EXAFS code, known as EX- CURV (Binsted et al., 1987(Binsted et al., , 1991)), incorporated fast algorithms for precise calculations of curved-wave single, double, and triple scattering effects and also included EXAFS analysis tools. A significantly improved set of theoretical standards is based on an automated, ab initio code FEFF3 developed by the present authors (Rehr et al., 1991;Mustre de Leon et al., 1991).1 This implementation of the theory includes both inelastic losses (which are neglected by McKale et al., 1986) and curvedwave effects (which are neglected in the Teo-Lee tables), together with an ab initio treatment of the molecular potential based on overlapped atomic densities. With all of these ingredients, the theoretical XAFS calculations give quantitative agreement with experiment for a wide range of materials. This formulation typically yields distance determinations to better than 0.02 Å and coordination numbers to within Ϯ1 (Rehr et al., 1991). As a result, many of the discrepancies between EXAFS and other techniques have been eliminated (Dagg et al., 1993). But neglecting one or the other, as in various earlier approaches, usually leads to significant errors. The accurate parametrization (Mustre de Leon et al., 1991) of the Hedin-Lundqvist self-energy made calculations of inelastic losses much easier to implement and speeded up ab initio calculations considerably. Yet another ab initio multiple-scattering EXAFS code is GNXAS (Filipponi and DiCicco, 1995;Filipponi et al., 1995), which is based on an efficient grouping of multiple-scattering paths for structural analysis.2

F. Outline
In the remainder of this paper, we review in more detail the modern theoretical approaches to XAFS calculations. We focus primarily on the conceptual ideas needed for an accurate theory of the XAFS spectra . For example, because of the large kinetic energy of the photoelectron state compared to chemical energies, the physical considerations needed in XAFS theory are rather different from those in modern ground-state electronic-structure calculations or in XANES. We also focus especially on deep-core-level absorption, which greatly simplifies the treatment of the initial state. Shallow core absorption and optical absorption often require quite different theories (Zangwill and Soven, 1980;Chelikowsky and Louie, 1996), such as the time-dependent local-density approximation. This review is not intended to address fully the case of XANES, in which, for example, the multiple-scattering expansion fails. Nor do we discuss the analysis of XAFS experiment (Binsted et al., 1987;Koningsberger and Prins, 1988;Filipponi and Di Cicco, 1995;Filipponi et al., 1995;Newville et al., 1995;Westre et al., 1995); the development of which has followed advances in the theory. Because the fine structure in both EXAFS and XANES involves fundamentally similar quantum-interference effects, they will be be discussed from a unified viewpoint, hence the shortened acronym XAFS. However, this synthesis is, as yet, not totally successful. For many reasons, especially due to atomic, chemical, and many-body corrections, the quantitative treatment of XANES remains a challenging and generally unsolved problem. For example, various atomic effects can become important in XANES and related spectroscopies (see, for example, de Groot, 1994;Kotani, 1997). For these reasons, we shall generally limit this review to a treatment of the XAFS , rather than the full absorption spectrum .
The outline for the rest of the paper is as follows: in Sec. II we discuss the physical processes involved in x-ray absorption and how they are included in modern theories of XAFS. In Sec. III we go into great detail to show how the multiple-scattering theory can be solved. This section has been emphasized, since it is the key to extracting the structural information from XAFS. In the last two sections (IV and V), we introduce additional complications due to thermal disorder, show how well the theory compares to experiment, and summarize the state of XAFS theory. Finally, we mention some connections between XAFS and related spectroscopies.

II. KEY APPROXIMATIONS A. One-electron golden-rule approximation
The dominant mechanism for the absorption of hard (ϳ10 keV) x rays by matter is the photoexcitation of electrons. Compton scattering is negligible for thin samples and pair production in the energy range of interest is forbidden. Moreover, the weakness of the electromagnetic field (even for current third-generation synchrotron x-ray sources) is such that only processes that are first order in the field are important. In consequence, the x-ray absorption coefficient is proportional to the transition rate as given by Fermi's golden rule. Most practical calculations of x-ray absorption are based on the one-electron approximation of the golden rule,
(3) Unless otherwise specified, for clarity, we shall use atomic units (eϭបϭmϭ1) in the formalism presented in this paper; when results are calculated for comparison with experiment, energies will be given in eV and distances in Å. The reduction to an effective one-electron approximation is discussed in detail in Sec. II.C.2. The wave functions i and f in this equation refer, respectively, to the initial and final eigenstates of the effective one-electron Hamiltonians H for the initial state and HЈ for the final state, with energies E i and E f , respectively. That is, the states i and f are generally calculated with different self-consistent potentials in a ⌬SCF approximation (Bagus, 1965), where SCF is an acronym for ''self-consistent field.'' The use of the final-state oneparticle Hamiltonian to calculate f is equivalent to the ''final-state rule.'' The quantity p is the momentum operator and A(r) is the vector potential of the incident electromagnetic field, which may be taken to be a classical wave of polarization ⑀ ˆЌk ˆ, i.e., A(r,t)Х⑀ ˆA0 e ik•r .
For deep-core excitations, the spatial dependence of the electromagnetic field (vector potential A) can usually be neglected (dipole approximation), i.e., e ik•r Х1. Quadrupole corrections are of order (Z␣) 2 , where Z is the nuclear charge seen by a core electron and ␣ Х1/137 is the fine-structure constant. Likewise, local-field effects are usually negligible for deep-core excitations (Zangwill and Soven, 1980). Several formally equivalent representations of the dipole operator exist. For example, using the commutator ͓H,r͔ϭp/m, the momentum form of the dipole operator can be replaced by the position form,
Here H is the effective one-particle Hamiltonian and the transition frequency. Similarly, one can derive an acceleration form. Partly owing to its simplicity and partly for numerical and physical considerations, the position form seems preferable for XAFS calculations and deep-core absorption.

B. Scattering potential
As noted in the Introduction, the oscillatory structure in the XAFS spectra results from the interference between contributions to the photoelectron wave function from various paths the excited photoelectron can take as it scatters off nearby atoms. In an effective one-electron theory this excited electron, as it traverses the solid or molecule, behaves as a quasiparticle that moves in an effective complex-valued ''optical potential.'' Such a lossy potential is needed to calculate the phase shifts, the scattering, and also the damping of the electron. In this section we discuss how such a potential is constructed for practical calculations, as well as the current advantages and limitations involved.
The nature of the effective one-particle scattering potential V has been considered by several authors (see, for example, Sham and Kohn, 1966;Hedin and Lundqvist, 1969;Lee and Beni, 1977;and Fujikawa and Hedin, 1989). Because of the excited-state nature of the photoelectron, its potential differs significantly from that used in ground-state calculations based on the localdensity approximation familiar from band-structure theory. The optical potential V appears in the non-Hermitian but otherwise Schro ¨dinger-like, one-particle Dyson equation for the photoelectron (quasiparticle) states ,
(in atomic units), or its relativistic generalization in terms of the Dirac equation. Here the operator
consists of the net Coulomb potential V coul felt by the photoelectron and a ''self-energy'' ⌺(E), which is analogous to the exchange-correlation potential V xc in ground-state calculations (Kohn and Sham, 1965). The functional form of ⌺(E) depends on the particular approximation used (Sec. II.C.2.a), but a local approximation appears to be an excellent approximation for highenergy excited states, partly due to the decrease of the de Broglie wavelength with increasing energy. It is also crucial that the energy dependence of ⌺(E) be taken into account. Indeed, the variation in ⌺(E) is typically about 10 eV over the experimental energy range of EX-AFS. This variation corresponds physically to turning off the exchange interaction with increasing energy. The optical potential is also dependent on the particular N-particle final state being considered and hence depends on both the core-hole state and the atomic/ molecular configuration of the system (Natoli et al., 1990). Finally, for practical considerations a spherical muffin-tin geometry, without corrections, is usually adequate for modern EXAFS calculations. In the final two subsections we discuss the nature of the potential used, both within the muffin tin itself and in the interstitial region between the muffin tins. While muffin-tin potentials may be of questionable validity near an x-ray edge or for total-energy ground-state calculations, nonspherical corrections generally diminish rapidly with increasing energy and can generally be neglected in the EXAFS regime. However, muffin-tin jumps can lead to oscillatory behavior of the phase shifts (Loeffen and Pettifer, 1996) and can also show up in the calculated background absorption 0 (Holland et al., 1978;Rehr et al., 1994).

Muffin-tin approximation
Almost all practical XAFS calculations currently rely on a muffin-tin geometry (cf. Figs. 9, 10, and 11), which consists of a spherical scattering potential centered on each atom and a constant value in the interstitial region between atoms. A tremendous amount of mathematical machinery has been built up over the last century that relies on spherical symmetry. The spherical muffin-tin geometry makes it possible to apply this machinery in a very efficient way. In the multiple-scattering approach that most directly connects to the underlying atomic structure of a material (see Sec. III), the muffin tins provide atomic scattering centers that are described completely by atomic phase shifts, which are calculated from spherically symmetric atomiclike potentials inside the muffin tins. Green's-function propagators are employed to connect these scattering centers. Accurate calculations depend on good potentials, since they determine the strength of the scattering at each site.
The actual potential in a material (solid or cluster of atoms) is, of course, more complicated. Near the center of each atom, the charge density of the atomic core will be large and dominate the potential. Hence the potential is approximately atomic-like very close to the nucleus, where the spherical approximation is highly accurate. In the outer regions of the atom and between the atoms, the bonding properties of a material determine the distribution of charge, and the potential is generally anisotropic. The degree of anisotropy depends on the type of bonding present (ionic, covalent, or metallic) and the types of atoms that are bonding. In close-packed metals, the electronic wave functions overlap so strongly that the bonding is much more flat and isotropic than in other, more open systems, where there can be strong spatial variations.
In EXAFS spectroscopy the kinetic energy of the excited electron is large, and the electron is less sensitive to the details of the potential at the outer edges of the atom and in the regions between the atoms. The electron is mainly scattered by the inner parts of the atomic potential and moves more or less freely in the average potential within the flat interstitial region. It is for this reason that a spherical muffin-tin potential works so well. In the near-edge region (XANES) and for groundstate total-energy calculations, the details of the shape of the interatomic potential are much more important. In Sec. II.B.2.a we shall return to a further discussion of non-muffin-tin effects. Holland et al. (1978) proposed another effect of the potential in the outer parts of an atom embedded in a solid. They suggest that it can give rise to additional weak backscattering of the photoelectron and hence extra oscillations in the absorption that resemble EXAFS  structure, but with an effective distance R that is approximately half the near-neighbor distance. Additional work on this subject, which has been termed atomic XAFS, has been done by Rehr et al. (1995). In particular, Rehr et al. (1995) suggest that atomic XAFS is sensitive to the nature of the bonding potential. The effect has been corroborated, for example, by Wende et al. (1997), Koningsberger et al. (1999), andRamaker andO'Grady (1999). However, a definitive theory of atomic XAFS will likely require corrections to the muffin-tin approximation. The effects of multielectron excitations on the atomic background can also be important (Filipponi and Di Cicco, 1996), but are typically smaller in magnitude.

a. Charge density and potential
The potential within a muffin tin depends on the charge density in this region, and it is essential to use approximations that conserve overall charge neutrality for an accurate determination of the energy reference. Because the muffin tin is centered on a given atom, most of the charge density is that due to the atom in question, with only small contributions in the outer parts due to the tails of neighboring atoms' charge distributions.
Perhaps the best charge density to use would be that produced by a modern full-potential self-consistent electronic-structure calculation (e.g., Blaha et al., 1997). Such calculations make no shape approximations (i.e., they make no muffin-tin or other restrictions on the shape of the charge density or potential) and include all modifications of the charge density due to bonding and other interactions with neighboring atoms. However, as we shall discuss in Sec. II.B.1.b, such a calculation should be modified for XAFS by including effects due to the presence of the core hole. That is, to be consistent with the final-state rule, the one-electron potential under consideration is usually taken to be the potential of the final state.
In practice, full-potential calculations are time consuming and not yet readily available for many complex systems studied by XAFS spectroscopies. Remarkably, they are not usually necessary (except, perhaps, close to an edge), since scattering off the atomic core is far stronger than scattering off the outer parts of the potential. Bigger errors come from the treatment of the selfenergy. Thus simpler prescriptions for the potential have proved to be accurate enough for a wide range of applications for large excitation energies. The easiest and most often used approach is based on overlapping, neutral, atomic-charge densities, which turns out to be a very good approximation to the total ground-state charge distribution. This prescription, pioneered by Mattheiss (1964) in the early days of electronic-structure calculations, requires placing the charge density from a neutral-atom calculation on each atomic center and then using a direct superposition of these charges to obtain the total charge distribution around any given atom. A muffin tin mainly has the charge density due to the central atom. At the edges of the muffin tin, however, some charge density from neighboring atoms spills in, thus re-moving the spherical symmetry. A proper treatment of this nonspherical charge distribution involves solving a set of coupled differential equations for the radial wave functions of different l (angular momentum) instead of the conventional equation for each l . This is fairly easy to do and is computationally inexpensive. Suggestions for how to do this can be found in many places in the electronic-structure literature, e.g., Evans and Keller (1971) and Siegel et al. (1976). These corrections are usually neglected in EXAFS calculations, and the charge density is spherically averaged, using, for example, the efficient Loucks (1967) algorithm. The Coulomb potential is easily calculated for such spherically symmetric charge densities (Loucks, 1967).
The neutral atomic-charge density may be calculated in several ways. Both conventional (nonlocal exchange) Hartree-Fock and local-density-approximation (LDA) atomic codes are readily available. There are also tables of charge densities available, such as those by Herman and Skillman (1963) and Clementi and Roetti (1974). For heavy atoms, relativistic effects are important and atomic densities based on a Dirac equation are most often used, e.g., using the semirelativistic code of Desclaux (1975) and a generalization of the Dirac-Fock Desclaux code by Ankudinov and Rehr (1996). LDA versions of these approaches are usually used for computational efficiency and typically allow a number of different ground-state exchange-correlation potentials to be used. For example, the von Barth and Grossmann (1982) exchange-correlation potentials usually yield accurate atomic-charge densities.
In standard electronic-structure calculations a groundstate LDA exchange-correlation potential is typically used for crystalline solids, while a Hartree-Fock exchange is often used for molecular calculations. As noted above, for XAFS applications it is important to take into account the energy dependence of the exchange-correlation potential, which includes the quasiparticle character of the excited electron and reflects the decreasing importance of the Pauli principle with increasing energy. XAFS calculations based on groundstate calculations miss this additional energy dependence and therefore differ systematically from spectra measured experimentally; see Sec. II.C.2.a.

b. Atomic configurations
In determining the muffin-tin scattering potential, an important consideration is whether to use (1) (initialstate rule) the ground-state charge density, or (2) (finalstate rule) the charge density with the core hole present (which was left behind by the excited photoelectron). In the latter case, which is currently used most often by default, the question of the appropriate atomic configuration for the final state with the core hole is not unambiguous. For the absorbing atom a reasonable approximation is a neutral atomic configuration of a free atom of atomic number Z c ϩ1 with a missing electron in a given core level, corresponding to the fully relaxed ''primary channel'' (Rehr et al., 1978). This choice is appropriate for low-energy XAFS, and since the primary channel usually dominates the XAFS, it is also an adequate approximation at high energies as well. Alternatively one could choose the same configuration as in the initial state with an appropriate hole and an extra electron in the lowest unoccupied state. Ionic configurations are appropriate only for highly ionized materials, but, due to charge-transfer effects, the net charge on an atom is usually much smaller than the chemical valence. Another choice appropriate for high energies (see, for example, Lee and Beni, 1977) is a completely unrelaxed potential. Usually we have found that XAFS calculated with a neutral, fully relaxed potential gives very good agreement with experiment. However, self-consistent potentials with a better treatment of many-body effects would be desirable in the future to help avoid these ambiguities.

Interstitial potential
The interstitial region causes more complications for XAFS than for typical ground-state electronic-structure calculations or for XANES. These complications are the following: (1) the most efficient multiple-scattering treatments assume that the interstitial potential has no spatial variation (i.e., is constant), which is not generally true; (2) for excited-state calculations the interstitial region is lossy and energy dependent; and (3) the critical parameter for determining structural information (the wave number k of the excited photoelectron) depends on the choice made for the average value of the potential in the interstitial region.

a. Muffin-tin corrections: warping
As discussed above, the electronic charge density in any real material is more complex than that implied by the muffin-tin approximation. Inside the muffin tins the charge density is not perfectly spherical, and in the interstitial region the charge density is not constant. Instead, it is often common to find a buildup of charge between neighboring atoms, where there is significant bonding. This same effect can be intuitively pictured as a consequence of overlapping atomic-charge densities, which also naturally leads to a buildup of charge between neighboring atoms. In order to evaluate the validity of the muffin-tin approximation, we review how nonmuffin-tin corrections to the potential are treated in ground-state electronic-structure calculations.
In the electronic-structure literature the spatial variation of the charge density in the interstitial region is sometimes called ''warping'' of the potential or charge density. Methods that include this effect are called ''fullpotential'' techniques (since the muffin-tin potential captures only the spherical part of the potential and misses the spatial dependence in the interstitial region). Such effects are often important for sensitive bonding properties.
For EXAFS this effect is of less importance. In addition to the simplification provided by the kinetic energy of the photoelectron being typically much larger than the size of the warping potential, in the muffin-tin ap-proximation the spatial variations in the interstitial region are also reduced by subtracting out the average interstitial potential. This greatly reduces the perturbation on the photoelectron. It is only in the XANES regime that warping begins to be a potentially serious problem, and then only within a few eV of the edge.
In band-structure approaches the warping has mainly been treated by taking advantage of the periodicity of the crystal. Any periodic function in a given crystal can be expanded in reciprocal-lattice plane waves. Matrix elements between the basis set used to expand the ground-state wave functions are typically reexpanded in a plane-wave basis, which then makes it mathematically rather easy to calculate the matrix elements that involve the interstitial potential. For most XAFS calculational methods, this periodicity is not assumed (except possibly in band-structure or exact diagonalization approaches; see Sec. III.B), and the simplicity introduced through the plane-wave expansions is not possible. Thus including warping within the XAFS formalism has been found to be very difficult. Although a scattering formalism has been developed by Natoli et al. (1986), it is difficult to apply in practice. Alternative approaches based on discrete basis sets have also been implemented in XANES (Ellis and Goodman, 1984;Joly et al., 1999), but appear to be computationally difficult to extend to EXAFS energies.

b. Excited-state effects
The spectrum of photoelectron (quasiparticle) states, moving in the optical potential V defined by Eq. ( 5), is determined from the solution to an electron-atom scattering problem. The unperturbed system contains a photoelectron of energy E and angular momentum L ϭ(l,m) moving in a uniform (lossy) optical potential, which is conventionally taken to be the average value V int (E)ϭ͗V(E)͘ in the interstitial region. Note that in general this uniform potential is energy dependent and complex valued, and hence the concept of a fixed ''inner potential'' in XAFS is not well defined. With V int (E) as an energy reference, the inelastic loss in a system is mostly accounted for by the uniform mean-free-path term calculated at the interstitial density. The scattering perturbation is then defined as the difference with respect to the uniform potential, which we denote by a lower-case v. This potential is usually expressed as a sum over a set of local potentials v j relative to atomic sites R ជ j , i.e.,
Some treatments, e.g., Teo and Lee (1979), use a real muffin-tin zero. Moreover, since there is virtually no inelastic loss in V(E) in the high-density core region of atoms, the scattering potential v(r,E) is often amplifying in the core region and hence leads to increases in the backscattering amplitudes and phases compared with those defined with respect to the vacuum level (Ekardt and Thoai, 1981).

c. Energy reference
The variation of V int (E) over the range of XAFS energies roughly amounts to the magnitude of the groundstate exchange hole, i.e., V xc ϳϪk F / in atomic units, where k F is the Fermi momentum and is typically about 10 eV. To circumvent this ambiguity in the comparison of theoretical XAFS standards with experiment, it is useful to define a fixed energy reference E 0 , the photoabsorption energy threshold. Experimentally, this threshold corresponds to the energy at the onset of an absorption edge. We emphasize that this threshold energy is not necessarily the midpoint of the main-edge step in the x-ray absorption coefficient, but rather at the onset of absorption for a given edge. Self-consistent calculations are needed to determine E 0 precisely (Ankudinov et al., 1998). However, values of E 0 that are typically valid to within a few eV may be estimated from the chemical potential of a homogeneous electron gas at the average interstitial-charge density. The errors introduced by the electron-gas approximation and the averaging of the interstitial potential and charge density are such that these estimates are typically a few eV higher than those from self-consistent calculations (Mu ¨ller et al., 1982;Mustre de Leon et al., 1991;Tyson et al., 1992;Ankudinov et al., 1998).

Relativistic effects
Relativistic effects per se have generally played a secondary role in XAFS theory. Similarly, spin-dependent effects are usually negligible and are manifestly important only when the dominant spin-independent contributions are forced to cancel, as in x-ray magnetic circular dichroism; see, for example, Brouder et al. (1996), Ebert (1996), and Ankudinov and Rehr (1997). To understand why this is the case, it is useful to review some basic aspects of electronic-structure theory.
In atomic theory it has long been recognized that relativistic effects are only important for very heavy (large-Z) atoms. For such atoms the kinetic energy of the electrons becomes quite large near the nucleus of the atom where relativistic corrections are essential. Besides modifying the wave functions and energy eigenvalues of the electronic states, these corrections also change the self-consistent potential. In contrast, at large distances from the atom the kinetic energy of the outermost electrons responsible for bonding properties and the photoejected electrons are usually well into the nonrelativistic regime. Thus relativity can strongly affect the production of the photoelectron and hence the atomic background 0 (Grant, 1970) through the dipole matrix elements, but have a weak effect on the propagation of a photoelectron (Loucks, 1967).
Multiple scattering in turn involves knowledge of both the photoelectron propagators connecting different atoms and the scattering t matrices, which depend on the phase shifts of the electrons at a muffin-tin radius. Clearly the electron propagators, which vary as exp(ikR), are essentially nonrelativistic (assuming paramagnetic materials with spin-independent potentials), and thus most of the propagation involves knowledge of the electron's behavior at large distances from the nucleus where relativistic effects are usually negligible, even for heavy atoms at the highest EXAFS energies (about 1500 eV). Thus the only place where relativity can play a substantial role is in the phase shifts themselves. Relativistic effects enter in two ways for such calculations. Because relativistic effects shift wave functions to distances closer to the nucleus, the selfconsistent potential must include relativistic effects. Secondly, for heavy atoms the wave function near the nucleus will be modified and affect the integration of the wave function for calculating the phase shifts, even if the correct self-consistent potential is known; this will modify the phase shift. To account for the first effect, it is standard to use a fully relativistic solution for the core electrons to get their correct charge density. Within the local-density approximation for the electronic potential this is very easy to do and requires almost no computational overhead.
For calculating the phase shift of the photoelectron, some approximations have to be made. The chief problem is symmetry. For the spherically averaged potentials used in XAFS, the nonrelativistic wave functions are labeled by spin and orbital angular momentum (l ). Relativistic wave functions have total angular momentum labels j as well as an additional label, usually (Rose, 1961), which specifies whether the l ϩs or the l Ϫs component is meant (e.g., whether the d 3/2 or d 5/2 component is being used). Because this difference between relativistic and nonrelativistic theories arises from the spin-orbit terms in the Dirac equation, a conventional approach in many electronic-structure methods has been to use semirelativistic solutions for the wave function (Andersen, 1975;Koelling and Harmon, 1977). Such as approach solves the Dirac equation, but averages the spin-orbit term over the two j components for each l . This removes the symmetry label problem. In the outer part of the atom where the electron is clearly in the nonrelativistic regime, it is easy to match the semirelativistic wave function onto its nonrelativistic form to find the phase shifts appropriate for a nonrelativistic multiple-scattering formalism. This approximation is very accurate and has been used in electronic-structure calculations since the mid 1970's; it also works very well for XAFS calculations (Mustre de Leon et al., 1991).
For very heavy atoms (e.g., 5d's, 4f's, and 5f's) the spin-orbit splitting of the outermost valence electrons can be significant, and a better theory is to retain the relativistic labels and to use the corresponding relativistic phase shifts (Tyson, 1994). Because the muffin-tin interstitial regions are in the nonrelativistic regime, one can form the correct linear superposition (using Clebsch-Gordan coefficients) of the nonrelativistic Green's-function propagators to form propagators of the correct relativistic symmetry (Ankudinov and Rehr, 1997). The multiple-scattering theory thus can be straightforwardly generalized from the nonrelativistic treatment (Gonis, 1992).

C. Many-body effects

Inelastic losses
As we have stressed, the inclusion of damping due to inelastic losses is a key ingredient in the modern shortrange-order theory of XAFS. These losses give the final photoelectron state a finite lifetime and hence lead effectively to a broadened one-electron spectrum. It is traditional to differentiate two types of inelastic losses in the photoabsorption, namely, intrinsic and extrinsic processes. Extrinsic effects refer to losses in propagation of the photoelectron and include excitations such as plasmons, electron-hole pairs, and inelastic scattering in which the photoelectron loses energy. Many of these processes are the same as for an electron beam as it traverses a solid (Quinn, 1962;Sevier, 1972;Powell, 1974;Seah and Dench, 1979;Wagner et al., 1980). These losses lead to a decay of the final state, which has been accounted for phenomenologically by an energydependent mean-free-path (k), i.e, a path-dependent decay factor exp͓Ϫ2R/(k)͔ of EXAFS amplitudes. However, such extrinsic losses are more precisely described in terms of a complex, energy-dependent selfenergy ⌺(E), which gives both a real energy shift and a decay (cf. Figs. 12 and13). Intrinsic losses, on the other hand, refer to excitations in response to creation of the core hole. These losses are traditionally accounted for phenomenologically by a constant many-body amplitude-reduction factor S 0 2 . However, more precisely, the amplitude reduction is energy dependent and must be described by a complex, path-dependent constant given by a ''phasor sum.'' We now summarize the commonly used approximations for these quantities.

Extrinsic losses a. Self-energy
The extrinsic losses and associated energy shifts can be described in terms of a self-energy operator ⌺(E). This operator is complex valued and energy dependent and arises from the dynamically screened exchange interaction between the photoelectron and the system (cf. Figs. 12 and13). This interaction is the analog of the real-valued exchange-correlation potential V xc () of ground-state calculations. The real part of ⌺(E) accounts for the energy dependence of the exchange and causes systematic shifts of location of the EXAFS peaks compared to the positions obtained for the ground state, while the imaginary part gives rise to the mean free path. As in conventional electronic-structure theory, the many-body nature and interactions of the electrons can be approximated within a local-density approximation ⌺(E,). The energy dependence of the screened exchange is of the order of several eV and decays slowly with energy, typically over a few hundred eV, but this is crucial for quantitative calculations of XAFS. Ultimately, the exchange interaction vanishes, and the photoelectron can be treated as a classical particle.
An appropriate generalization of the local-density approximation for excited states is again based on a uniform electron-gas model, e.g., the Hedin-Lundqvist GW/ plasmon-pole self-energy ⌺ HL (E,) (Hedin and Lundqvist, 1969;Lundqvist, 1977). Here GW refers to an approximation for the electron self-energy which neglects vertex corrections, where G is the Green'sfunction operator and W is the screened coulomb interaction. This model was introduced into XAFS theory by Lee and Beni (1977). However, full calculations within this model are computationally time consuming. Thus in practice it is preferable to use accurate analytic representations in both energy and density (Lu et al., 1989;Mustre de Leon et al., 1991) of ⌺ HL . Although there is some evidence for positive corrections to the Hedin-Lundqvist self-energy (Horsch, von der Linden, and Lukas, 1989;Mustre de Leon et al., 1991), the model appears to be accurate to within a few eV at XAFS energies. To avoid a discontinuity at the Fermi energy, it is convenient to shift the self-energy by a constant, i.e., ⌺(E,)ϭ⌺ HL (E,)Ϫ⌺ HL (E F ,)ϩV xc ().
The excited-state potential is therefore given by V(E,r ជ) For convenience, the same (y-axis) numerical scale was used for both quantities (one is positive and one is negative). However, (E) is in units of Å and the Im ⌺ is in eV.
ϭV(r ជ)ϩV xc ()ϩ⌺ HL "E,(r ជ)…Ϫ⌺ HL "E F ,(r ជ)…. The advantage of this formulation over other approximations, such as the nonlocal Hartree-Fock or the analogous LDA Dirac-Hara self-energies (Chou et al., 1987), is that extrinsic losses are represented fairly accurately in terms of the imaginary part of ⌺(E,). A disadvantage is that the plasmon-pole approximation introduces a weak, unphysical cusp singularity at the onset of plasmon excitations in the near-edge region. Other more sophisticated approaches to the self-energy have been suggested, but these are mostly formal and have yet to be widely implemented (Fujikawa and Hedin, 1989;Fujikawa et al., 1995).

b. Mean free path
The effect of the imaginary part of the self-energy is similar to Lorentzian broadening of the XAFS spectrum with a half-width Im ⌺ (Schaich, 1973) and accounts for extrinsic losses. As noted above, the Hedin-Lundqvist (1971) self-energy ⌺ HL (E) yields a good approximation for these losses (Mustre de Leon et al., 1991) for EX-AFS. Thus the model generally gives good agreement (Penn, 1987) with experimental values of the XAFS mean-free-path Хk/͉Im ⌺(E)͉ for a variety of systems. This relation follows by expanding the relation (in atomic units) (1/2)k 2 ϭ(1/2)(kϩi/) 2 ϭEϪ⌺(E). The quantity is also in accord with the ''universal'' meanfree-path curve (Lindau and Spicer, 1974;Seah and Dench, 1979), apart from a factor of 2, since the ''universal curve'' measures the shorter-range decay in electron-beam intensities, while the XAFS mean free path measures the decay in the wave amplitude. Despite the good agreement for EXAFS, at low energies the Hedin-Lundqvist model based on the plasmon-pole approximation tends to give too much loss and moreover exhibits a sharp, unphysical jump at the onset of the plasmon excitation energy. This excessive loss can be corrected, for example, by using an ad hoc positionaveraged approximation, as discussed, for example, by Penn (1987) and by Roy and Gurman (1999). However, such an averaging destroys the local behavior of (r). Clearly a better treatment is desirable.

c. Energy shifts
A comparison of XAFS peak energies, as calculated by ground-state band-structure theory or measured in experiment, reveals a systematic shift that can be represented at low energies by an approximately linear scaling with energy, i.e., E exp ϭE th (1ϩ␣), where ␣ is typically about 0.05 (Materlik et al., 1983). See, for example, Figs. 12 and 14. Such a scaling is actually consistent with the effect of a real energy-dependent self-energy or exchange interaction, as shown by Mustre de Leon et al. (1991). Although this effect is ignored in phenomenological XAFS theories (e.g., theories containing only a mean free path or an imaginary optical potential), it could have been anticipated, since the presence of a mean-free-path term implies the existence of a real energy shift due to the dispersion relations satisfied by the self-energy operator.
3. Intrinsic losses and the initial-and final-state rules a. Amplitude-reduction factor S 0 2 Intrinsic losses correspond to excitations that arise due to the creation of a core hole in the photoabsorption process. Although the theory of XAFS is often couched in a one-electron language, where a single electron makes a transition from a core orbital to an excited state, the process is truly many body, and other electrons are generally excited as well. Examples of intrinsic processes are the well-known shakeup and shakeoff excitations in which more than one electron is excited in a transition. This secondary emission results from a relaxation of the NϪ1 electron Fermi sea in response to the creation of a core hole. Because both of these processes involve the same final states, their quantum-mechanical amplitudes can in principle interfere, and hence one cannot simply add their transition rates. We review here the treatment of such intrinsic effects given by Rehr et al. (1978). This treatment ignores interference effects that can be important near the edge, but appears to be adequate for current EXAFS calculations. In any case, a fully satisfactory theory has yet to be developed.
To understand the origin of such intrinsic effects, one must examine the full many-body expression for the x-ray absorption spectrum,
In the Hartree-Fock or density-functional-theory approximations, for example, the initial and final states are Slater determinants of one-particle states, calculated with different self-consistent one-electron potentials, i.e., the self-consistant-field approximation, as discussed, for example, by Bagus (1965). The potential for the initial state is that of the ground state, while that for the final states includes a core hole and a photoelectron. The calculation can be simplified if one assumes that the final state can be factored, i.e., ͉⌿ f ͘ϭ͉⌽ 0 Ј NϪ1 ͉͘ f ͘, which is a reasonable approximation at high energies, when the ''sudden approximation'' is valid. Then the dominant contribution to the many-body dipole matrix element is given by
where the prime refers to states calculated in the presence of the core hole. Thus the absorption in the lowest energy or ''primary channel'' is reduced in magnitude from the one-particle expression by a many-body overlap integral,
(10)
In this approximation the one-electron matrix element for the primary channel is consistent with the final-state rule, i.e., that the core orbital should be calculated with the initial ground-state Hamiltonian and the final state with the presence of a fully relaxed core hole (von Barth and Grossmann, 1982).

b. Excitations
Because of these relaxation effects, the observed EX-AFS amplitudes are reduced from their one-electron values by a phenomenological factor, which is usually taken to be a constant. To see this, one must examine the contribution from excitations (see Natoli et al., 1990). Indeed, if S 0 2 1, there must be contributions from multielectron transitions in which the (NϪ1)-electron ''ion'' is left in an excited state ͉⌽ n Ј NϪ1 ͘ with excitation energy E n . The net absorption is then given by a sum over excited states or ''channels'' n,
where the many-body overlap integral S n ϭ͗⌽ n Ј NϪ1 ͉⌽ 0 NϪ1 ͘; also, the energy of the photoelectron is reduced in accordance with energy conservation by the excitation energy E n . The quantity S n is usually small (for n 0) and would vanish by orthogonality in the absence of relaxation. Thus the total absorption in this approximation is equivalent to a convolution, i.e., to a broadened one-particle calculation:
where ˜is the one-electron spectrum and A()
adding the effect of extrinsic losses (which adds additional broadening) to this result is equivalent to calculating the photoelectron state f with a complex optical potential. Similar convolution expressions have also been derived with other formalisms, e.g., the generalized GW approach of Hedin (1989) and the multichannel multiple-scattering theory of Natoli (1990). Due to completeness of the ⌽ n Ј NϪ1 states, the sum of the weights S n 2 is unity. They can be interpreted in the ''sudden approximation'' as the probabilities that the ion, initially in the ground state, finds itself in the nth final excited state,
͉⌽ n Ј (NϪ1) ͘. According to the Manne-Aberg theorem, the centroid of the excitation spectrum corresponds to Koopman's theorem for the transition energy (Manne and Aberg, 1970). The difference between the centroid and the onset of absorption is defined as the relaxation energy. Since Koopman's theorem involves the groundstate wave functions, if the excitation spectrum were a ␦-function spectrum, the initial-state rule would be valid.
The initial-state rule states that the photoelectron should be calculated with the ground-state charge density (i.e., in the absence of a core hole). Such a photoelectron would then have a Koopman's energy given by the difference between one-electron eigenvalues. At low energies close to threshold, no additional excitations are allowed (by conservation of energy, the photoexcited electron needs sufficient energy to cause the additional excitations), and only the primary channel is available. This is consistent with the final-state rule, in which the core hole is fully relaxed, since such a photoelectron energy would include a relaxation energy. Conversely, at high energy all the possible channels are active, and the average energy of the excitation spectrum is centered around the Koopman's theorem value. Since the XAFS oscillations are widely spread out at high energies, one can view this spectrum as a smeared ␦ function, yielding results roughly equivalent to the initialstate rule.
The above convolution was derived assuming that interference between extrinsic and intrinsic terms can be neglected, but this is not necessarily valid at low energies. One effect of this interference is the presence of ''replacement terms'' in the Hartree-Fock approach (Friedel, 1969) that give rise to the x-ray edge singularity. An elegant formal treatment of extrinsic and intrinsic processes, which also includes the effects of interference as well as the crossover between the initial-and the final-state rules, has been given by Bardyszewski and Hedin (1985) and further discussed for XAFS by Hedin (1989). Such interference effects appear to be particularly important in the near-edge region. For example, it has been shown formally (Inglesfield, 1983;Bardyszewski and Hedin, 1985;Fujikawa, 1993) that extrinsic and intrinsic losses tend to cancel near threshold, and hence shakeup and shakeoff excitations are suppressed at low energies.

c. Phasor sum
The effect of intrinsic excitations for XAFS from paths with path length 2R (Rehr et al., 1978) can be obtained from a convolution similar to that above, which can be expressed in terms of a phasor sum,
where k()ϭͱ, kЈ()ϭͱϪЈ, and A ˜() ϭA()/͐ 0 dЈA(Ј). At intermediate EXAFS energies, the denominator of A ˜is unity, and the phasor sum is dominated by the primary channel with the value S 0 2 , while at both low and very high energies S 2 reduces to unity. Thus, in general, instead of a constant S 0 2 , this result shows that the one-electron XAFS signal must be multiplied by an overall complex-valued amplitudereduction factor S 2 (E,R), which is weakly energy and path dependent. The overall effect is similar to a small additional contribution to the mean free path.

III. CURVED-WAVE MULTIPLE-SCATTERING THEORY

A. Multiple-scattering expansion
The development of curved-wave multiple-scattering theory was a key step in the success of the modern theory of XAFS. This theory yields a unified treatment of XAFS, encompassing both EXAFS and XANES, as well as a formal equivalence between the multiplescattering expansion carried to all orders and exact treatments. For a review of the theory, see, for example, Fonda (1992). Of central importance is the question of convergence: how many terms are needed and which are they? A detailed study (Zabinsky et al., 1995) shows that neither low-order nor full multiple-scattering theories are fully satisfactory. Instead, a configurational average of sufficiently high-order multiple-scattering appears to be necessary for the convergence of both EXAFS and XANES calculations. Our review focuses particular attention on the main computational difficulties in calculating multiple-scattering to high order: (1) the large angular momentum basis needed at high energies, (2) the exponential proliferation of multiple-scattering paths, and (3) the need for multiple-scattering Debye-Waller factors. We illustrate our findings with a typical example in which high-order multiple-scattering plays a significant role: the XAFS of Cu metal and, for comparison, the band-structure approach.
The starting point for the multiple-scattering theory of XAFS (Schaich, 1973;Lee and Pendry, 1975) is an expression for the x-ray absorption that is equivalent to the golden rule, but is written in terms of the projected photoelectron density of final states or, equivalently, the imaginary part of the one-particle Green's function, G ϭ(EϪHϩi⌫) Ϫ1 . The Green's-function formulation is particularly advantageous for XAFS, since it can naturally incorporate inelastic losses and other quasiparticle effects and avoids the necessity of explicit calculations of wave functions. In position space G(r,rЈ;E) has the spectral representation
where f are final states with energies E f of the effective final-state one-particle Hamiltonian H including an appropriately screened core hole, which is described by the optical potential v(r)ϭVϩ⌺ (Sec. II.B), and ⌫ is a net lifetime, including effects of extrinsic and intrinsic losses.
In terms of G, the absorption from a given core level c is given by
where ⌫ is a broadened step function at the Fermi energy E F . It is now convenient to separate the problem into a single scatterer at the absorption site (which is taken to be the ''central atom'') and the remaining scatterers, which are treated in perturbation theory, i.e., G ϭG c ϩG sc . Here the local representations of G c and G sc (Ankudinov et al., 1998) are
where Lϭ(l ,m), R L (r)ϭi l R l (r)Y L (r ˆ) is the regular solution to the Dyson equation, and
The main ingredients for the scattering part G sc are the dimensionless two-center free propagator G LR,L Ј R Ј 0 and the dimensionless scattering t matrix t LR,L Ј R Ј ϭe i␦ lR sin(␦ lR )␦ RR Ј ␦ L,L Ј . With these ingredients, the total scattering-propagator matrix G L Ј R Ј ,LR sc (E) can be obtained by matrix inversion from the full multiplescattering equations G sc ϭG LR,L Ј R Ј sc ϭexp(i␦ l ϩi␦ l Ј )(1 ϪG 0 t) Ϫ1 G 0 (matrix indices suppressed). Note that our scattering formalism is cast in terms of Green's-function propagators and phase shifts. A related approach based on the so-called scattering-path operators has also been used in many treatments of XANES (e.g., those of Durham et al., 1982 andTyson et al., 1992). Both approaches are formally equivalent within multiplescattering theory for real energies. However, the propagator formalism has somewhat better analyticity properties; for example, the path-operator formalism contains singular factors such as (Im t l )/sin 2 ␦ l , which are not unity for complex energies.
An important result of the multiple-scattering formalism (Lee and Pendry, 1975) is that the expression for can be factored in terms of an atomic background absorption modulated by the XAFS , i.e., ϭ 0 ͑ 1ϩ l ͒,
where the brackets denote a thermal and configurational average, and the free propagator G 0 is defined to be zero when R ជ ϭR ជ Ј. This result shows that the atomic background absorption in XAFS is given by an energydependent, embedded-atom cross section 0 , i.e., the absorption for an atomiclike state is defined by the central potential v c rather than being that for a ''free atom'' (Rehr et al., 1994). This factorization of is also particularly important for interpreting XANES (Ankudinov et al., 1998), since it cleanly separates atomic and scattering parts. In addition, since the imaginary part of G is the density matrix, Eq. ( 15) implies that the absorption from a given final state l is proportional to the projected density of final states (in the presence of an ap-propriately screened core hole) l Ј (E), i.e., ϳ l Ј , which has a similar factorization in terms of an atomic part and fine structure, i.e.,
Here 0l
Ј is the density of states for an embedded atom. Because of the similarity between and l Ј , it is widely thought that XANES essentially measures the projected density of states (Mu ¨ller et al., 1982). However, this interpretation can be misleading, because of final-state effects such as core-hole effects, lifetime broadening, or energy shifts. Thus an interpretation of XANES in terms of the ground-state angular momentum projected density of states must be used cautiously. Moreover, the factorization of and l into atomic and fine-structure parts is strictly valid only for real potentials (Tyson et al., 1992). The correction can be important for XANES and especially for the shape of the edge rise, since otherwise the absorption may not be positive definite. However, the error arises from the cusp singularity in the centralatom Green's function in Eq. ( 16), which leads to a small additional contribution to the background absorption close to the Fermi energy and has no effect on the XAFS . As shown by Schaich (1973), this real-space inverse-matrix formulation of XAFS is directly analogous to the Korringa-Kohn-Rostoker band-structure approach and hence is equivalent to long-range-order theory. Indeed, the paper by Schaich essentially unified the long-and short-range-order and theories within muffin-tin multiple-scattering theory. This formal unification based on multiple-scattering theory has also been discussed, for example, by Benfatto et al. (1986) and by Natoli et al. (1986). The connection with the shortrange-order theory may be obtained by expanding the inverse matrix as a geometric series, G 0 tG 0 ϩG 0 tG 0 tG 0 ϩ...; the first term is missing since G 0 ϭ0 when R ជ ϭR ជ Ј. Thus one sees immediately that the exact result, which is given by the full matrix inverse, can be expressed equivalently as a sum over all multiplescattering paths (provided, of course, that the series is convergent), and may be labeled by a path index ⌫, i.e.,
Here t i is the scattering t matrix at site i, ␦ l is the partial-wave phase shift at the absorbing atom, and again, the outer brackets indicate a thermal and configurational average. The relativistic generalization of this formula is similar. The short-range-order theory of XAFS therefore amounts to retaining only a finite summation of the multiplescattering series, together with the inclusion of Debye-Waller factors and inelastic losses. Convergence of the multiple-scattering series is governed by several factors, such as the mean free path, the spherical factors (1/kR) for each leg of length R, the strength of the scattering at each site, and the exponential decay factor exp͓ϪR/(k)͔ due to the mean free path. Moreover, as shown, for example, by Rehr (1994), the Debye-Waller factors introduced by the thermal and configurational average can aid significantly in the convergence of the multiple-scattering series. For example, for repeated multiple-scattering paths of n legs, the Debye-Waller factors converge as a Gaussian in the number of scatterers, exp(Ϫn 2 2 k 2 ), which is much faster than the convergence due to the mean-free path alone, exp(Ϫn͗R͘/), where ͗R͘ is the mean bond length. Indeed, this Debye-Waller factor is important, for example, in studies of ''shape resonances'' in nearedge XAFS, which are large, shape-dependent features in the XANES of low-Z molecules (Sto ¨hr, 1992). As shown by Rehr et al. (1992), calculations without such a configurational average (Sto ¨hr and Bauchspeiss, 1991) can be too sharp.

B. Full multiple-scattering methods
In the previous section we reviewed the multiplescattering expansion needed to calculate XAFS. Ideally, one might want to solve this set of equations exactly, which is equivalent to summing the expansion to infinite order. In practice, such an infinite summation requires a change of technique. In conventional electronicstructure approaches this summation can be reformulated in terms of a Hamiltonian that is diagonalized in order to solve for its eigenfunctions, or alternatively a matrix inversion of the multiple-scattering equations, Eq. ( 17). The chief advantages of modern full-potential electronic-structure methods (Albers, 1989) are that (1) they provide accurate self-consistent calculations of the electronic charge densities and potentials appropriate to the crystalline or molecular environment (i.e., they have no spherical approximations), (2) they provide an accurate calculation of the Fermi energy relative to the unoccupied states, and (3) they treat curved-wave effects exactly and multiple scattering to all orders. For these reasons, some of the most definitive calculations of XANES have been based on band-structure methods (Mu ¨ller et al., 1982;Albers et al., 1985). Because these methods use a local-density-functional approximation (LDA), they also provide excellent ground-state charge densities, which are needed for the electrostatic component of the potential; indeed, this is needed even for methods that attempt to go beyond the conventional LDA, such as those for calculating excited-state quasiparticle spectra.
Given these powerful advantages, one can ask: why use a finite multiple-scattering approach for XAFS instead? Why not immediately jump to full-potential methods? The answer is, of course, their equally strong disadvantages for calculations not close to an x-ray edge:
(1) such methods cannot easily include other important physics such as Debye-Waller factors, core-hole potentials, and final-state lifetime effects, which are crucial beyond about 50-100 eV of an edge; (2) they are computationally inefficient since they provide an unnecessarily high degree of detail about the electronic structure (all of the many excited-state eigenstates, van Hove sin-gularities, etc.), which are then washed out by the various broadenings and lifetime effects encountered in experiment; and (3) they are limited to the near-edge region because the number of basis-set functions and orbital angular momentum components that must be included is a rapidly increasing function of energy above the edge. Thus the physics of XANES and EXAFS differ in several key respects and require different algorithms for accurate treatments. Moreover, since exact methods have implicitly summed all scattering paths, one cannot disentangle this information to interpret the contributions from specific paths, which is needed to extract bond-length and bond-angle information. That is, such exact methods are not tuned into the atomic structure of the material, but instead are focused on indirect manifestations of the structure, for example, in densities of states.

Band-structure and exact diagonalization methods
Exact diagonalization methods are particularly useful for XANES calculations. For example, the most successful early methods of band-structure calculation for crystalline solids were based on the same muffin-tin approximation as the multiple-scattering approach: the augmented plane-wave method and the Korringa-Kohn-Rostoker method. It has long been known that the two are equivalent. The chief difference is that the augmented plane wave uses an augmented plane-wave basis while the Korringa-Kohn-Rostoker is based on multiplescattering theory. The Korringa-Kohn-Rostoker method for a periodic crystal is, in fact, the solution to the infinite multiple-scattering expansion used in XAFS, if one ignores the core-hole and energy-dependent exchangecorrelation potential.
In principle, the core hole could be taken into account in a band-structure approach by using the supercell technique, which is often used to calculate point defects in a crystal. In this technique, a number of unit cells are combined to form a larger unit cell (the supercell), which is then periodically repeated in all directions. Point defects (like the atom with the single core state missing) are placed near the center of the unit cell, and the system is converged until self-consistency is achieved. Supercells are usually tested for convergence as a function of cell size. The goal is to reduce defect-defect interactions by increasing the distance between their periodic replacements. In practice, this approach is expensive computationally, because of the large basis sets that must be diagonalized (diagonalization costs often go up as N 3 , where N is the number of basis functions, which typically scales linearly with the number of atoms in the unit cell).
With respect to the energy-dependent exchangecorrelation potential, it is probably best to think of it in terms of a quasiparticle picture of excited states. Strictly speaking, this goes beyond the customary realm of bandstructure theory, which is mainly directed towards ground-state properties of solids. It has long been known that the energy eigenvalues of conventional LDA band-structure calculations are not true quasiparticle excitation energies. In practice, this distinction has been blurred by the often excellent agreement that occurs between these eigenvalues and the observed lowlying excitation energies. Recent advances in electronicstructure theory such as the computationally expensive GW approximation disscussed in Sec. II.C.2.a or other self-energy corrections have provided some guidance for calculations of the energies for excited states (Hedin and Lundqvist 1969;Hybertsen and Louie, 1985;Aryasetiawan and Gunnarsson, 1998;Aulbur et al., 2000). Modern XAFS calculations usually make use of a simplified LDA GW approximation for the self-energy (Mustre de Leon et al., 1991). However, as far as we know, a full GW approach has not yet been applied to XAFS calculations. Also, band-structure techniques do not automatically include the intrinsic broadening (or lifetime) of the true quasiparticle excitations, since they treat all excited states as infinitely sharp (i.e., as exact eigenstates of the system). However, these broadening effects can be approximately corrected a posteriori by a Lorentzian convolution of the spectrum (Rehr et al., 1978;Mu ¨ller et al., 1982).
As noted above, most current electronic-structure methods are now full-potential techniques. This means that the muffin-tin approximation is superseded, and the full shape of the true electronic charge density and potential throughout all space is used. Such techniques yield very accurate results for calculating geometrical structures of the atoms (by minimizing the total energy of the system as a function of atomic positions). For XAFS calculations, such corrections are important only in the near-edge regime (XANES) for highly covalent materials with open structures. Well above the edge (the EXAFS regime) the kinetic energy of the excited photoelectron dominates and non-muffin-tin corrections appear to be negligible.
The chief technical difficulty in using conventional band-structure techniques involves limitations in the choice of basis set. As the wave functions are calculated at higher and higher energies above the Fermi energy, more and more basis functions are needed. More specifically, successively higher orbital angular momentum components must be included (e.g, f, g, h, and higher), as well as higher principal quantum numbers (unoccupied states) for the same orbital angular momentum states that are occupied. The huge increase in basis size drastically increases computational cost, which often scales as the cube of the number of basis functions (for those methods that rely on diagonalization techniques). The wave functions are also very extended and become strongly hybridized. The number of energy eigenvalues also grows tremendously as a function of energy above the Fermi energy (for example, simple free-electron theory gives a quadratic density of states as a function of energy). The combination of these factors typically limits the effectiveness of most band-structure (as well as cluster) techniques for XAFS calculations to about 100 eV above the edge.

Full multiple-scattering cluster methods
The full multiple-scattering cluster approach is intermediate between band-structure and path-by-path techniques (Johnson, 1973;Dehmer and Dill, 1976;Kutzler et al., 1980). Like band structures it typically involves setting up a basis for expanding the system's wave functions and then diagonalizing a Hamiltonian to solve variationally for the best set. Alternatively, in the cluster Green's-function approach a multiple-scattering matrix must be inverted (Durham et al., 1982;Ankudinov et al., 1998). Like the path-by-path approach, these methods rely on the mean-free-path cutoff for convergence with respect to cluster size and to suppress surface effects.
It is perhaps easiest to discuss the main idea of the cluster approach from a pathlike analysis. As we mentioned earlier in this article, the main XAFS structure arises from quantum interference as the excited photoelectron scatters off nearby atoms. Since the photoelectron has a finite mean free path, in principle, one only needs to know the electronic structure of the photoelectron for a cluster of atoms around the absorbing site with a size of the order of the mean free path. This suggests that, whether one is investigating a periodic solid or a molecule, an electronic-structure calculation for a large enough cluster should provide all the relevant information needed for understanding an XAFS experiment.
In practice there are some additional issues that should be carefully considered. The first is cluster size: the cluster chosen must be large enough so that the boundary conditions imposed by cutting off the cluster at some finite size do not significantly affect the electronic structure of the cluster in the region sampled by the excited photoelectron.
Another consideration is diagonalization costs. As in the band-structure method discussed above, the basis set needed to handle highly excited photoelectrons must be drastically expanded. This requirement again usually restricts the applicability of cluster calculations to the first 100 eV or so above the absorption edge. Despite this limitation, there are some important advantages of the full multiple-scattering cluster approach, which make such calculations very useful in XANES applications of complex systems. For example, as in the band-structure approach, multiple scattering within the cluster is treated to all orders. Although Debye-Waller factors are neglected, they are relatively unimportant near the edge. Also, some systems, especially biological systems, often have no periodicity (i.e., they do not form in crystals) and have complex asymmetric geometries that would be nearly impossible to treat from a conventional bandstructure point of view (i.e., as a periodic crystal).
As in band-structure calculations, all of the questions about constructing the potentials seen by the photoelectron and whether they can be treated by muffin-tin or full-potential LDA approaches arise. In addition, it is well known that there can be serious errors in an LDA approach for excited states, and Hartree-Fock or other excited-state approaches may be needed. In particular, it is often important to take into account the energy dependence of exchange-correlation effects.
The muffin-tin approach can be dangerous for calculating optimized structures of small molecules by energy minimization techniques, since large fractions of the occupied-electron wave functions spill into the interstitial region between atoms, where there are consequently significant deviations from a constant potential. However, the high kinetic energy of the photoexcited electron is not particularly sensitive to these perturbations. One can therefore argue that muffin-tin approaches are adequate for the XAFS spectra even when such calculations give poor results for the ground-state properties of such systems. This also raises the issue of whether nonself-consistent potentials (e.g., calculated by overlapping atomic charge densities) may actually be better than self-consistent muffin-tin potentials. If the muffin-tin approximation is poor for the ground-state (nonexcited) electrons, self-consistency could actually drive the potential into a peculiar, less accurate regime.
Like band structures, many different basis sets and approaches are possible. A commonly used cluster multiple-scattering approach is the X ␣ scattered-wave method (Johnson, 1973;Kutzler et al., 1980). For a recent discussion see, for example, Tyson et al. (1992), who also discuss multiple scattering more generally, using both full and low-order methods. Drawbacks of these full multiple-scattering approaches are the muffintin potential approximation and the limitation to low energies. Generalizations that allow for corrections to the muffin-tin approximation have been treated by Natoli et al. (1986). An alternative method, the discrete variational method of Ellis and Goodman (1984), uses a local basis that avoids the muffin-tin approximation but is also limited to low energies, as is the discrete-point finite-difference method of Joly et al. (1999). Another development in multiple-scattering calculations was made by Durham et al. (1982) through the development of a cluster-based method, which recognized the importance of scattering in the neighborhood of the absorbing atom. Their approach attempts to include the most important multiple-scattering contributions by calculating multiple scattering to all orders within a given coordination shell, but only including a limited number of intershell scatterings. The method was improved by Vvedensky et al. (1986) to control the number of scatterings taken into account, and also by Della Longa et al. (1995). This method has been used extensively for XANES calculations, but computational problems limit its use to low energies and small clusters. An alternative approach is the recently developed continued-fraction method for summing the multiple-scattering series exactly for paths or clusters (Filipponi, 1991;Filipponi and DiCicco, 1995;Filipponi et al., 1995). This method is potentially faster than the multiple-scattering cluster methods, but again becomes very time consuming and hence not applicable at high energies. Recently the cluster Green's-function multiple-scattering method was extended to permit self-consistent calculations (Ankudinov et al., 1998) yielding both projected electronic den-sities of states and x-ray absorption spectra, including an approximate treatment of Debye-Waller factors.

C. Path-by-path methods
The path-by-path multiple-scattering approach has proved to be the most useful general method for analyzing EXAFS experiments. Its main advantages are its computational efficiency and accuracy; moreover, it provides a geometrical parametrization and interpretation of EXAFS, which is ideal for analyzing interatomic distances and other structural quantities. Fourier transforms of the XAFS indicate that the near neighbors generally give the dominant contributions, but also show that multiple-scattering contributions from more distant paths eventually dominate the signal. Although even merely enumerating the multiple-scattering paths can quickly become a computational bottleneck, since the number of paths of a given length grows exponentially with path length, this can be circumvented, as discussed below.

Exact path methods
The path-by-path approach for calculating multiplescattering contributions to XAFS was pioneered by the work of Lee and Pendry (1975). However, calculations based on exact multiple-scattering formulas are time consuming and could only be carried out for singlescattering paths and a few low-order multiple-scattering paths. By using the plane-wave approximation, one could take the path method to high order, but, as discussed above, that approximation works well only at high energies with an ad hoc inner-potential shift. A significant advance in the theory by Mu ¨ller and Schaich (1983) showed, using angular momentum identities, that exact single-scattering curved-wave calculations could be calculated in closed form. This was extended by Gurman et al. (1986) to permit fast, exact calculations of low-order multiple-scattering paths. This degree of approximation can give accurate EXAFS calculations, but higher-order paths are sometimes important, and, in any case, the method is so time consuming at high energies that it is effectively limited to triple-scattering paths. A more systematic, recursive method for calculating highorder multiple-scattering paths was derived by Brouder et al. (1989).

Small-atom approximations
Several attempts to improve the plane-wave approximation have been made, using variants of the smallatom approximation (Rehr et al., 1986). These authors show analytically that curved-wave corrections introduce a significant phase shift of order l (l ϩ1)/kR into each partial wave and hence are important throughout the entire XAFS regime. That is, the plane-wave approximation, even with an energy shift, can only be correct for a single partial wave in a narrow energy range. Methods based on the small-atom approximation have good accuracy for single-scattering extended XAFS, but lose precision at low energy, and especially for noncollinear paths. They are now supplanted by more accurate numerical methods (see below). However, the smallatom approximation does serve to illustrate the effects of curved-wave corrections theory and also provides quick estimates of the contributions from high-order multiple-scattering paths, which can be used as path filters to help solve the path proliferation problem (Zabinsky, 1995).

Separable approximation
A major advance in XAFS theory, which overcomes all the major computational difficulties of the multiplescattering expansion, is based on a separable representation of the Green's-function propagators developed by the present authors (Rehr and Albers, 1990) and will be referred to as the Rehr-Albers method. The difficulties addressed include (1) the large angular momentum basis; (2) the proliferation of multiple-scattering paths; and
(3) the need for correlated multiple-scattering Debye-Waller factors. The first difficulty, the angular momentum problem, was overcome in two steps. First, by using rotation matrices, successive bonds in a path can be rotated to the z axis, thereby reducing the problem to a calculation of ''z-axis propagators'' (Rehr and Albers, 1990). Propagators along the z axis have mathematical properties that simplify in an angular momentum basis. Indeed, the use of z-axis propagators alone is a significant improvement, since (1) it separates the angularand energy-dependent behavior of the propagators, (2) it is very accurate at high energy, and (3) it permits an expansion in the angular quantum number m, as discussed by Barton and Shirley (1985). However, these propagators alone do not remove the angular momentum bottleneck, since this representation still couples high angular momenta, which makes the method inefficient for high-order calculations. Although the terminology ''z-axis propagator'' is recent, these quantities have a long history and have been rediscovered several times. Recursion relations for such propagators were developed earlier, in particular, by Nozawa (1966). However, it has recently been found that a stable and accurate procedure (Manar and Brouder, 1995;Sebilleau, 1995) is to use the recursive calculations of the separable representation, which we now discuss. A related approach is given by Fritzsche (1992). A detailed discussion of the convergence of the Rehr-Albers approach is given by Chen et al. (1998).
The second step of the Rehr-Albers method is an exact, separable representation of the z-axis propagators, which was inspired by an earlier, low-energy approximation of Barton and Shirley (1985). The separable representation yields an exact matrix factorization of the full propagator of the form
where RЉϭRЈϪR. The generalized spherical harmonic expansion coefficients Y and Y ˜converge rapidly in pow-ers of 1/kR, and hence the representation can usually be severely truncated. The approach becomes exact at low energies or for single scattering, and typically only six terms suffice to within experimental precision for the full range of wave numbers 1рkр20 Å Ϫ1 normally encountered in XAFS experiments. At lowest order or high energies the result becomes equivalent to the smallatom approximation discussed above. The advantage of the separable representation is that it permits one to combine and then sum all the factors involving L at a given site into a scattering matrix F Ј , ϭ ͚ L Y ˜Ј ,L t L Y L, , which is the analog of the scattering amplitude. Moreover, the method gives an accurate curved-wave XAFS formula directly analogous to that with the plane-wave approximation, but with the usual scattering amplitudes f() replaced by low-order (typically 6ϫ6) matrices F. The method can naturally be generalized to include off-diagonal t matrices with muffin-tin corrections. The efficiency of the Rehr-Albers approach is due to this truncated separable representation, as one can quickly multiply any number of 6ϫ6 matrices. Thus, for an N-leg path ⌫ with scatterers at R 1 ,R 2 , . . . ,R N ϭR 0 , the result for the XAFS amplitude is
Here i ϭp(R i ϪR iϪ1 ), pϭͱEϪV mt is the photoelectron momentum measured with respect to the muffin-tin zero (in Rydberg atomic units), F i is the scattering matrix at site i, M l is the termination matrix for the final state of angular momentum l , S 0 2 is a many-body reduction factor, and ⌫ 2 is the mean-square variation in total path length R tot . The adequacy of 6ϫ6 matrices was verified by using the exact z-axis propagators (Rehr and Albers, 1990), which are slower by one or more orders of magnitude. Finally, when one substitutes k ϭͱp 2 Ϫk F 2 and redefines terms appropriately, it is clear that the result for ⌫ can be recast exactly in terms of the standard XAFS formula, but with an effective scattering amplitude f eff ,
The second difficulty mentioned above is the pathproliferation problem. Fast multiple-scattering calculations of a given path are not enough to calculate XAFS for a material, due to exponential path proliferation. Fortunately, it turns out that the vast majority of multiple-scattering paths are of small amplitude and largely cancel, apart from tolerable random phase fluctuations. Thus the path-proliferation problem can be overcome by introducing ''filters'' in the path enumeration scheme to restrict the number of paths under consideration (Zabinsky et al., 1995). Although many paths are insignificant, it is often not obvious a priori which must be kept. To automate this procedure, the contribu-tion of a given multiple-scattering path can be estimated using the plane-wave approximation or spherical wave approximation, and only those paths of amplitude larger than a given cutoff are retained. This is done with a constructive ''heap algorithm'' (Zabinsky et al., 1995) that only retains the subset of paths less than a given path-length cutoff that are likely to be important. To deal with degeneracies, physically equivalent paths are hash sorted, and only those with amplitudes above a second cutoff are retained. That is, each path is assigned a unique 32-bit number or hash key, based on its geometry, which is independent of orientation and hence easy to sort. With these filters only a few percent of the multiple-scattering paths within a given cluster need to be calculated to yield XAFS accurate to a few percent. Typically this amounts to around 100 paths. Finally, to address the third difficulty, Debye-Waller factors are easily added, usually by the average ͗e 2ikR ͘, and ignor- ing the distance variation of all other terms (see Sec. IV). In the XANES region, Farges et al. (1997) found that smaller values of the path cutoffs and typically 1000 or more paths are needed to simulate the spectra when the multiple-scattering expansion converges.

D. Alternative methods and extensions
Various alternatives to the path-by-path method have been discussed. For example, the group n or GNXAS method (Filipponi and Di Cicco, 1995;Filipponi et al., 1995) systematically combines all the multiple-scattering contributions for a given set of n sites within a cluster. This approach has conceptual simplicity in that the multiple-scattering series contains many fewer distinct terms than the path-by-path methods. This overcomes the path-proliferation problem, and grouping the terms in this way has been shown to lead to faster convergence of the multiple-scattering series. On the other hand, each such term then contains contributions at a number of distinct path lengths, which complicates the treatment of vibrational and structural disorder and requires a numerical configurational average. However, the approach emphasizes the desirability in path-by-path methods of forming path groups, which combine all significant paths of a given path length, to achieve optimal convergence. The GNXAS approach also uses a recursion method in the XANES region, which is usually efficient compared to exact matrix-inversion schemes. Yet another approach to XANES (Fujikawa, 1993) is based on repartitioning the multiple-scattering matrix to sum exactly certain strong multiple-scattering terms (such as the multiple scattering from near neighbors to the absorbing atom), while treating the remaining terms with a pathby-path expansion. In our view, the development of such efficient approaches will be important in solving the still intractable problem of XANES calculations in large clusters. Yet another approach is that of Huasheng and Tong (1999), based on an iterative multiple-scattering scheme.

E. Example of multiple-scattering approaches
The Rehr-Albers approach (Rehr and Albers, 1990) has proved to be a powerful method for XAFS calculations in general materials. In many cases in which the multiple-scattering expansion converges adequately, the approach also yields good results for XANES. One of the first examples is the calculation of * shape resonances in small molecules, which dominate the fine structure in XANES, referred to as near-edge XAFS (Sto ¨hr, 1992). For these systems, the Rehr-Albers approach gave generally good agreement with X ␣ calculations (Sto ¨hr and Bauchspeiss, 1991) and also showed the importance of multiple-scattering Debye-Waller factors in comparisons with experiment (Zabinsky et al., 1995).
Another example of the accuracy of the Rehr-Albers multiple-scattering approach is the case of Cu metal (see Rehr et al., 1992, and Figs. 15 and 16). Because of its close-packed structure and strong scattering potentials, fcc Cu provides a severe test for multiple-scattering theories. Indeed, there are about 10 6 paths of length less than the typical mean free path (about 20 Å), and the original calculations that demonstrated the convergence of the multiple-scattering series to band-structure accuracy required several CRAY CPU hours to complete (Fig. 17). However, the introduction of path filters with a cutoff set to 4% of the first-shell amplitude eliminates most of these paths. The value 4% roughly corresponds to the magnitude of experimental noise. For example, only 54 of the 17 134 paths out to the eighth shell survive the path filters, and of those paths, those with more than four legs contained collinear scatterings (cf. Table I and Fig. 18). Such collinear paths have long been known to be important (Lee and Pendry, 1975), due to the large forward-scattering focusing effect of an intermediate atom on the contribution from a given path. Surprisingly, however, the calculations on Cu showed that triangular paths are also important and can be comparable in importance to focusing paths, especially for short bond lengths (cf. Table II and Fig. 19). On the other hand, higher-order noncollinear paths tend to be negligible; such paths involve a product of scattering amplitudes, which can only be significant at rather low energy. Highly automated methods based on the Rehr-Albers approach now provide the main algorithm for much current XAFS analysis work (see, for example, Newville et al., 1995).
Finally, Farges et al. (1997) have shown the convergence of the finite multiple-scattering path expansion in the near-edge region of certain complex minerals, namely, Ba 2 TiO 4 and K 2 TiO 5 , with the Rehr-Albers approach (see, for example, Fig. 20). Note that all XANES features in this figure, including the ''pre-edge'' features, are reproduced by the calculations.

IV. DEBYE-WALLER FACTORS AND DISORDER

A. Introduction
The XAFS Debye-Waller factor arises as a natural consequence of fluctuations in interatomic distances. At  finite temperatures, as the atoms vibrate around their equilibrium lattice sites, they slightly alter the interference pattern for a given path. The net signal results from an average of ͗e 2ikR ͘ over many paths, which tends to smudge details of the XAFS amplitude at higher values of k (shorter wavelength). This factor is analogous to that encountered in x-ray diffraction and generally adds an exponential decay factor to the XAFS amplitude (Crozier et al., 1988). Because of its near-Gaussian form, e ϪW Ϸexp(Ϫ2 2 k 2 ), this factor is largely responsible for the exponential decay of XAFS with increasing energy (or k) and for its temperature dependence (see Fig. 8). Its crucial importance in quantitative XAFS theory was recognized early by Schmidt (1961Schmidt ( , 1963) ) and is one of the key ingredients in the modern XAFS equation (Sayers et al., 1971). Such factors are generally ignored in most ground-state electronic-structure and quantumchemistry calculations, since 2 k 2 Ӷ1 at sufficiently low energies. Additionally, there are anharmonic corrections that are necessary for understanding the effects of thermal expansion on XAFS (Eisenberger and Brown, 1979). Currently the standard treatment of such vibrational and configurational disorder is based on phenomenological models, such as the correlated Einstein (Sevillano et al., 1979) and correlated Debye (Beni and Platzman, 1976) models. However, these models are only marginally satisfactory in current XAFS theory. In the future, it would be desirable to calculate these factors from an ab initio approach, which is quite difficult at present (Dimakis and Bunker, 1998;Poiarkova and Rehr, 1999). The summary below is not intended to be exhaustive, but to highlight the most important aspects of this topic. For additional discussion, the reader is referred to various reviews (e.g., Crozier et al., 1988;Dalba and Fornasini, 1997).

B. Formal properties
The XAFS Debye-Waller factor can be viewed as a result of averaging the contribution to the XAFS signal from a given scattering path over all thermally accessible configurations of the atoms in that path. It is not necessary to distinguish between single-and multiple-TABLE I. List of the first 20 most important multiplescattering paths for fcc Cu. For each path, the table contains R eff (one-half of the total path length), the relative mean path amplitude C cw in percent (where the first path is arbitrarily assigned a value of 100%), the lengths of each leg using Lee and Pendry's notation (Lee and Pendry, 1975), the degeneracy of the path, the total number of legs in the path, and a brief description of the shape of the path. The mean path amplitude is an average of ͉(k)͉ over nine evenly spaced k points. This table is a partial reproduction of Table I of Zabinsky et al. (1995), where a more complete description is given. See also Fig. 18 for a pictorial representation of some of the paths.   I. In particular, ss stands for single scattering. Comparing the descriptions with the actual path should make evident why these descriptions were chosen. The labels such as 11, 411, etc., are Lee and Pendry's notation (Lee and Pendry, 1975). They essentially give the near-neighbor distance of each leg in the path. The distances between atoms in the horizontal direction are 0.707 that of the distance between atoms in the vertical direction (the cube-edge distance). For this (110) plane of atoms, along the horizontal direction one has, successively, a corner atom, an atom in the center of a face, and then the next corner atom diagonal to the first, and so on. Some curved arrows were used to make the paths clearer; without them, some of the arrows would overlap each other and hence obscure each other.
scattering paths, since both are parametrized similarly in terms of an effective scattering amplitude f eff in the standard curved-wave XAFS formula (Poiarkova and Rehr, 1998). To a very good approximation one can ignore (or lump into the distribution function) the weak configurational dependence of the scattering factor, f eff /kR 2 , so that the multiple-scattering Debye-Waller exp(ϪW ⌫ ) for a path ⌫ comes only from the average over the oscillatory factor in the XAFS equation, i.e., ͗e 2ikr ͘ϭe 2ikR e ϪW ⌫ (k) ,
where RϭR tot /2 denotes the mean half-total path length for a multiple-scattering path of total length R tot and instantaneous half-length r. In the remainder of this section we shall ignore the path-index subscript ⌫, unless it is needed explicitly.
where ␤ϭ1/k B T. In addition, there may also be static disorder, which is obtained by a further configurational average. To the extent that thermal and configurational disorder are independent, their contributions to the net Debye-Waller factor are simply additive.  The main difference between the Debye-Waller factors in XAFS and those, for example, in x-ray diffraction, is the dependence of the XAFS Debye-Waller factor on displacement correlations. Only those displacements that change the total path length affect the interference pattern. To see this, let u i be the displacement from equilibrium of the ion at site i, so that, neglecting terms of order u i 2 , the effective path length for a scattering path with n legs is
Here, iϩϭiϩ1 mod(n), Rϵ(1/2) ͚ i R iiϩ is, as before, the effective equilibrium half-path length, and R iiϩ is the equilibrium vector between atoms i and iϩ. From the Born-Oppenheimer approximation, the ion motion can be regarded as stationary during the photoexcitation process. Hence the thermal averages are to be carried out in the ground state prior to the x-ray absorption, rather than in the relaxed final states. Now, for any harmonic Hamiltonian or Gaussian disorder one has the exact result (Maradudin et al., 1971)
(26)
Here, 2 denotes the mean-square fluctuation in the effective path length R, 2 ϭ(1/4)͓͗ ͚ iϭ1 n (u i Ϫu iϩ )
•R ˆiiϩ ͔ 2 ͘. For example, in the single-scattering case with two atoms at sites 0 and R,
The displacement correlations decay algebraically with distance, and the scalar products insure that only modes contributing to motion along a bond path are important. Therefore the XAFS Debye-Waller factor provides a measure of the displacement-displacement correlation function.
As discussed by Sevillano et al. (1979), the temperature dependence of 2 in the harmonic approximation (see Fig. 21) can be calculated in terms of a certain projected local vibrational density of states ⌫ () and is therefore determined by the local vibrational structure in the vicinity of the path of interest,
Here, ⌫ is an appropriate reduced mass for the scattering path ⌫, and max is the maximum frequency of the lattice motion. For example, for single scattering the projected density of modes is
where denote the eigenfrequencies of the dynamical matrix D, and ⑀ R () the normalized eigenvectors. Equation-of-motion approaches for efficient calculations of ⌫ () and 2 , including quantum effects, have recently been discussed by Poiarkova and Rehr (1998).

C. Phenomenological models
Unfortunately, the dynamical matrix or even the local spring constants are not known in most cases of interest, and hence in practice one must often rely on simpler, phenomenological approximations. Two such methods are the correlated Debye and correlated Einstein models, which have been modified from the conventional Debye and Einstein models to approximately account for displacement-displacement correlations.

Correlated Debye model
The correlated Debye model was introduced in XAFS theory by Beni and Platzman (1976). As in the original Debye model (see, for example, Ashcroft and Mermin, 1976), the model assumes a homogeneous system with a constant speed of sound and a maximum phonon frequency D and gives a Debye integral for the displacement-displacement correlation function. Equivalently, the model gives a spherical approximation In the small-cluster calculations, the TiO 4 unit was embedded in the larger cluster, which is representative of the mediumrange environment around Ti in this crystal structure. The label n indicates the maximum number of legs allowed in the multiple-scattering paths. Note that, as additional multiplescattering paths are included, the theoretical calculation slowly converges to experiment. This figure is Fig. 7 of Farges et al. (1997), where more details can be found.
to 2 with a projected vibrational density of states for an atomic bond (0,R) of the form (Sevillano et al., 1979)
Here, D ϭk B D /ប is the Debye frequency, D is the Debye temperature, cϭ D /k D is the Debye approximation for the speed of sound, k D ϭ(6 2 N/V) 1/3 , and N/V is the atomic density number of the crystal. The second term in the brackets accounts for correlations and depends on bond length.

Correlated Einstein model
The correlated Einstein model approximates the projected vibrational density of states with a single delta function, centered at the effective vibrational frequency E ⌫ for a given multiple-scattering path ⌫:
The appropriate Einstein frequency E ⌫ can be interpreted (Frenkel and Rehr, 1993;Hung and Rehr, 1997) in terms of the local potential energy in a normalized lattice state corresponding to path ⌫. For example, in the single-scattering case, E is related to the local effective bond-stretching force constant k R ϭ R E 2 (R). This value of E (R) is equivalent to the natural vibrational frequency of the bond (0,R) together with all attached neighboring bonds, but regarding all other masses as fixed. Similarly, the potential energy (1/2)k 2 of a stretched path with path-length fluctuation 2 is equal to that of a single spring model with reduced mass and spring constant kϵ E 2 . Although the Debye model is often better than the Einstein approximation for systems with acoustic modes, neither is usually adequate for heterogeneous systems. One can also obtain an estimate of E ⌫ by scaling the Debye temperature (Sevillano et al., 1979;Lottici, 1987).

D. Radial distribution function
The configurational and thermal average ͗¯͘ can be defined in terms of a radial distribution function appropriate to a given path. For weak disorder, the distribution function can be approximated by a Gaussian, with width 2 . Anharmonic corrections and any skew in the radial distribution generally lead to corrections to the Gaussian form of the Debye-Waller factor. Due to the limited data range of the XAFS (generally between about 2 and 20 Å Ϫ1 ), the precise nature of the radial distribution function cannot generally be determined. It is often useful, however, to parametrize this distribution function, particularly in disordered systems. Alternatively, one can define the XAFS entirely in terms of the contributions from the various irreducible n-atom distribution functions, as in the GNXAS approach (Filipponi and DiCicco, 1995;Filipponi et al., 1995). However, such n-atom distributions are considerably more complicated than two-atom distributions and have weaker XAFS contributions, so this can be difficult to achieve in practice.  et al., 1980). This figure was adapted from Fig. 5 of Poiarkova and Rehr (1998), where a more detailed description of the results may be found.

E. Cumulant expansion
The cumulant moments (Kubo, 1962) of the distribution (or cumulants) are more stably determined and have a more natural interpretation. The use of cumulants for XAFS was introduced by Rehr (1979), who showed that the XAFS Debye-Waller factor is generally complex and has a natural cumulant expansion in powers of k of the form
where (n) denotes the nth cumulant average. The leading cumulants (with respect to the mean) are given by (see Crozier et al., 1988) (1) ϭ͗͑rϪR ͒͘,
(3) ϭ͗͑rϪR ͒ 3 ͘,
Explicit examples of such cumulants are discussed by Bunker (1983). Thus, neglecting small contributions from the mean free path (which implies a complex k), the amplitude of the XAFS Debye-Waller factor exp(ϪW) contains only even moments, W(k)ϭ2 2 k 2 Ϫ(2/3) (4) ϩ..., whereas odd moments contribute to the XAFS phase ⌽(k)ϭ2k (1) Ϫ(4/3) (3) k 3 ϩ... . The k 3 behavior is particularly important for large disorder.
If not corrected for, the term with the third cumulant gives rise to an apparent contraction of distances extracted from XAFS experiment with increasing temperature (Eisenberger and Brown, 1979). This anharmonic effect on the XAFS phase is illustrated in Fig. 8, which shows the XAFS for Ag at various temperatures.
Recently it has been found that these anharmonic corrections can be roughly accounted for by taking advantage of certain algebraic relations between the cumulants. These relations have been derived by making use of an effective cubic, anharmonic pair potential V(x) ϭ(1/2)kx 2 ϩk 3 x 3 for a given path, where xϭrϪR. The effective coupling constants in these relations are those for an anharmonic correlated Einstein model that takes into account the interatomic potentials as well as contributions from neighboring springs (Frenkel and Rehr, 1993;Hung and Rehr, 1997). For example, it was found (Stern et al., 1990;Wenzel et al., 1990) that in the classical limit the cumulant ratio j
(3) / j (1) j 2 (T)ϭ2. This relation breaks down at low temperatures TϽT D , but has been generalized (Frenkel and Rehr, 1993) to yield relations for (1) and (3) in terms of 2 (T) and the net thermal expansion, (1)
Thus calculations of 2 (T) alone suffice to determine the anharmonic corrections up to an overall constant.
Moreover, Hung and Rehr (1997) show that the cumulant ratio, including quantum corrections, can be expressed as
Here 0 2 ϭប͓2 E (R)͔ Ϫ1 is the zero-point contribution to 2 (T).
There are a host of corrections to these results (Dalba and Fornasini, 1999). Most are relatively small and generally negligible compared to uncertainties in the Debye-Waller factors, which are typically of the order of 10-20%. For example, there are small corrections from the distance dependence of the spherical wave factors 1/R 2 in the XAFS formula. These can be lumped into an effective distribution function with a slightly different peak position, leading to a correction to (1) Ϸ4k 2 /R. In addition, there are Debye-Waller spherical wave corrections in the effective scattering amplitude, which can be estimated using the spherical wave approximation (Rehr et al., 1986). This yields an additional energyindependent amplitude factor for each partial wave l , t l →t l exp(ϪW l ), where W l ϷϪ2 2 l (l ϩ1)/R 2 (Fujikawa et al., 1999). These corrections tend to reduce the Debye-Waller factor. In addition, because of thermal expansion, all the microscopic force constants are expected to vary with temperature and pressure. This yields an additional weak, linear, anharmonic, temperature dependence in 2 (T) at high temperatures, i.e., 2 (T)→ 2 (T)(1ϩcT), where c is proportional to k 3 and the Gruneisen parameter. Quartic and higher-order cubic (ϳk 3 2 ) terms in the effective potential also lead to corrections that are linear in T.

V. CONCLUSIONS
A series of remarkable advances in the theory of x-ray absorption spectroscopy has been made over the past few decades, spurred in part by the availability of modern synchrotron-radiation x-ray sources. As a result, the theory of extended x-ray absorption fine structure is now in a very mature state that provides a qualitative understanding of all the physical processes involved, as well as a detailed quantitative agreement with experiment. The key ingredients in the theory differ from those needed in conventional ground-state electronicstructure calculations and include high angular momentum scattering processes in a non-Hermitian optical potential and Debye-Waller factors to account for vibrations and disorder. Automated computer codes that implement the theory are now available for general materials. The success of the modern theory represents one of the few cases in which theoretical efforts have explicitly focused on the quantitative treatment of an experimental technique and shows what can be achieved with such a focus.
A large factor in the success of the theory is the tractability of the physics in the regime in which it operates. In this case, the accuracy of the many approximations made is due largely to the high kinetic energy of the excited photoelectron, which dominates much of the physics. This also explains why EXAFS is such an excellent tool for probing local structure, since pathinterference effects at large wave numbers dominate other competing physics. Moreover, at high energies the one-electron theory is a good approximation, and manybody effects can be incorporated in an energydependent self-energy that can be well approximated by the local-density approximation. Also, at high energy, scattering is relatively weak and can be treated to an excellent approximation by a finite, albeit high-order, multiple-scattering expansion, in the short-range order theory. Indeed, the essential difference between EXAFS and XANES is found to lie in the strength of the scattering, with the crossover energy being typically about 30 eV or less. Interestingly, curved-wave corrections are important at all energies, and simpler approximations such as the plane-wave approximation or the spherical wave approximation are inadequate even at high energies. In addition, it suffices to use spherical approximations for the scattering potentials at high energies, e.g., the muffin-tin model, and to ignore self-consistency. Debye-Waller factors that account for displacementdisplacement correlations and disorder are especially important in achieving the correct amplitudes. Finally, an account of anharmonicity is important in order to achieve a proper understanding of the temperature dependence of the XAFS phase. Remarkably, the standard EXAFS equation of Sayers et al. (1971) turns out to be a robust parametrization of the modern theory, provided that all quantities in the equation are appropriately redefined.
Although most of the physical quantities needed in the theory can be determined by ab initio calculations, a few quantities must still be determined phenomenologically. These remaining, poorly known quantities mainly affect the EXAFS amplitudes. For example, the correlated Debye model, with the Debye temperature T D as a single fitting parameter, is often a reasonable approximation, although improvements are desirable in anisotropic systems. Moreover, it would be useful to have a fully ab initio procedure for the Debye-Waller factors and anharmonic corrections; this generalization would require total-energy calculations, which is presently impractical in general systems. Secondly, various manybody effects that determine the magnitude of the amplitude reduction factor S 0 2 are not quantitatively understood. Similarly, the behavior of the self-energy is currently based on rather simple electron-gas models and should be improved to achieve more accurate determinations of the mean free path and self-energy shifts. Thus, although the XAFS technique probes electronic excited states of the materials under investigation, the excited states themselves play a secondary role in modifying the basic interference fingerprint of the underlying fine structure. Nevertheless, such amplitudes and phases are critical to the application of the EXAFS technique to extract accurate distances and coordination numbers from experiment. While much work still needs to be done to refine various aspects of the theory and to make the tool more useful in extracting subtle structural details of complicated materials, the major pieces of physics are now well in hand.
The most troubling and difficult aspects of x-ray absorption occur in the near-edge region. There the present theories are at best only in semiquantitative agreement with experiment. This is precisely where the dominance of the large kinetic energy of the excited photoelectron breaks down, and scattering and bonding effects are important. In this regime, the details of the spatially complex, potential-energy surface between atoms starts to become significant, and the complications of excited-state physics (e.g., intra-atomic excitations such as shakeup and shakeoff, exciton excitations, and resonance structures and phenomena) make the theory much less tractable and general. However, the factorization of XANES into an atomic background and XAFS contributions, i.e., ϭ 0 (1ϩ), can still be used to separate out the atomic and scattering contributions. The scattering contributions to the XANES appear in and must be treated with a full multiple-scattering approach when the multiple-scattering expansion breaks down. Moreover, much of the underlying near-edge phenomenon depends not just on the atomic structure of the material, but much more significantly on the details of the electronic structure (e.g., whether the system is a metal, insulator, or semiconductor). For example, the screening of the core hole appears to be system dependent and can dramatically affect the behavior of 0 . Similarly, there can be local-field corrections to the dipole operator and hence the atomic cross section can become important for shallow-core excitations. Thus the accurate calculation of the atomic background is an important challenge for future theories and is of critical importance to an accurate interpretation of XANES. It is for these reasons that this review has focused primarily on the fine structure in the higher-energy x-ray absorption.
The success of EXAFS theory as a structural probe suggests the fruitfulness of extending the theory to related experimental probes such as electron energy-loss fine structure (see, for example, Denboer et al., 1994;Rez et al., 1998), diffraction anomalous fine structure (see, for example, Cross et al., 1998), x-ray magnetic circular dichroism (see, for example, Thole et al., 1992;Ebert and Schu ¨tz, 1996), and photoelectron diffraction (see, for example, Fadley, 1991;Kaduwela et al., 1991). The basic physics in all of these techniques involves similar high-order electron-atom multiple-scattering processes, which can all be treated with similar theoretical tools. Indeed, much work along these lines is currently in progress.
Hung, and S. I. Zabinsky, We also thank T. Fujikawa, L. Hedin, C.R. Natoli, and J. W. Wilkins for helpful comments and advice, and our experimental colleagues, in particular, K. Baberschke, G. E. Brown, S.

APPENDIX: MUFFIN-TIN RADII
In a muffin-tin approach, an important consideration is the choice made for the size of the muffin tins. Since this is rarely, if ever, discussed in the literature, in this appendix we have collected the conventional wisdom about how such a choice may be rationally made and the pros and cons of different choices.
Within a muffin-tin approximation it is important to optimize the calculation by adjusting the size of the muffin tins surrounding each atom (both the central atom whose core electron is being excited and neighboring atoms). Ideally, one would like to have a full-potential method for XAFS that would take into account the full spatial dependence of the charge density (see the discussion in Sec. II.B.2.a). In the absence of such a method, some reasonable choice has to be made for the muffintin radii of all the different atoms. Like all approximations, such a choice is based on intuition and experience. For XAFS one can try a number of ideas derived from the early history of electronic-structure calculations, when muffin-tin calculations were extensively employed.
Muffin-tin approximations fall into two general classes: overlapping and nonoverlapping. The nonoverlapping case usually tries to maximize the radii so that the muffin tins touch or nearly touch. This is done to minimize the amount of interstitial region, where the potential is treated less accurately than inside the muffin tins. The overlapped case requires criteria for how big to make the muffin tins. This and related issues will be discussed below. Either case involves some choice of relative size for different types of atoms and how to scale them.
Three different approaches to choosing relative radii are often employed:
(1) Empirical radii based on experimental considerations of diverse phenomena such as Pauling, covalent, metallic, or other radii can be used to scale the relative size of different atomic muffin tins.
(2) The muffin tins can be adjusted until the groundstate potentials (including Coulomb and exchange cor-relation) at the boundary of neighboring atoms are approximately equal (Johnson, 1973). This approach is based on the intuitive idea that the potential should not jump discontinuously across boundaries. It is often applied to the case of muffin tins that nearly touch each other. It can sometimes be an unrealizable condition for systems with three or more types of atoms that touch at different places.
(3) Norman (1976) has suggested counting charge to determine relative radii. In this prescription the atomic charge densities are overlapped, and the radii around the atoms are chosen such that the spherically averaged charge within each radius contains an amount equal to the neutral atom, analogous to the Seitz radius r s used in solid-state physics. This has proved to be a reliable and easily automated prescription and hence is probably most often employed in practice. Indeed, this is the standard approach used in most of our XAFS calculations (Mustre de Leon et al., 1991;Zabinsky et al., 1995). For strongly ionic systems this prescription is sometimes modified to take into account charge transfer (i.e., integrating the radius out to a value such that a few extra electrons or a few less electrons are within the spherethis would correspond to a negative or positive ion). For molecular complexes that carry a charge, an outer shell of charge, or ''Watson sphere,'' is often added to simulate effects of global charge neutrality. Different suggestions have been made as to where to place the Watson sphere (Johnson, 1973;Vaughan, Tossell, and Johnson, 1974).
Conventional multiple-scattering theory involves nonoverlapping muffin-tin spheres. At one time this was regarded as the only available choice. More recently, some electronic-structure methods have analytically continued this approach to larger radii such that the different spheres overlap; see, for example, the method developed by Andersen, (1975;Skriver, 1984). Analytical continuation means that the formalism is derived for nonoverlapping spheres, and then the radii for the overlapping spheres are simply used. The use of overlapping spheres is driven by the large interstitial regions that can sometimes occur in open structures with large atom-size differences. Overlapping the spheres can decrease the amount of interstitial volume and hence reduce the effects of potential inhomogeneity in the interstitial volume. In a crystalline solid the overlapping sphere sizes are often scaled so that the net sum of the muffin-tin volumes equals the volume of the unit cell. In this case the sphere radii are usually called Wigner-Seitz radii, in analogy to a procedure used in one of the first electronic-structure approximations (Wigner and Seitz, 1934). The argument is then made that the interstitial region can be neglected. In practice, such overlapping electronic-structure calculations have often been more accurate than calculations with nonoverlapping spheres. It appears that the overlap somehow partially compensates for non-muffin-tin variations in the charge density. For noncrystalline solids, it is less clear how one should scale the overlapping radii. Fortunately, for XAFS, overlapping muffin tins and ionized atoms have often been found to have little effect on the calculated spectra. Again, the physical reason is that electron-atom scattering is dominated by the nearly spherical potential deep within a muffin tin; however, this approximation becomes less accurate in the XANES region.
Whether or not the spheres are overlapped, it is still necessary to choose the zero of energy in the interstitial region where the effective potential is considered to be a constant, since this determines the kinetic energy of the excited electron (the k vector). In close-packed crystalline solids there is a well-established procedure developed in the early days of electronic-structure calculations for nonoverlapping muffin tins. This procedure, which involves a simple averaging of the charge between the muffin-tin radius and the Wigner-Seitz radius, is discussed by Loucks (1967). This method can be generalized to noncrystalline materials in terms of the Norman radius. Overlapping spheres have also been proposed for molecular calculations (see, for example, Herman 1977) and compared with nonoverlapping sphere calculations (Rosch, Klemperer, and Johnson, 1973;Batra and Robaux, 1974;Norman, 1974). The results were mixed-better for some properties using the overlapping, and in other cases worse. In our experience, overlapping of spheres can improve the calculated XAFS spectra in the near edge, but otherwise has little effect.
