Full-potential multiple scattering for core electron spectroscopies

Introduction
Multiple-scattering theory (MST) is a technique for solving a linear partial differential equation over a region of space with certain boundary conditions. It is implemented by dividing the space into non-overlapping domains (cells), solving the differential equation separately in each of the cells and then assembling together the partial solutions into a global solution that is continuous and smooth across the whole region and satisfies the given boundary conditions.
As such, MST has been applied to the solution of many problems drawn both from classical as well as quantum physics, ranging from the study of membranes and electromagnetism to the quantum-mechanical wave equation. In quantum mechanics it has been widely used to solve the Schrödinger equation (SE) (or the associated Lippmann-Schwinger equation (LSE)) both for scattering and bound states. It was proposed originally by Korringa and by Kohn and Rostoker (KKR) as a convenient method for calculating the electronic structure of solids [1,2] and was later extended to polyatomic molecules by Slater and Johnson [3]. A characteristic feature of the method is the complete separation between the potential aspect of the material under study, embodied in the cell scattering power, from the structural aspect of the problem, reflecting the geometrical position of the atoms in space.
Applications of the KKR method were first made within the so-called muffin-tin (MT) approximation for the potential. In this approximation the potential is confined within nonoverlapping spheres, where it is spherically symmetrized, and takes a constant value in the interstitial region. Moreover, although spherical symmetry is not formally necessary, the condition that the bounding spheres do not overlap was thought to be necessary for the validity of the theory. Despite this approximation the method is complicated and demanding from a numerical point of view and as a band-structure method it was therefore superseded by more efficient linearized methods, such as the linearized muffin-tin-orbital method (LMTO) [4] and the linearized augmented-plane-wave method (LAPW) [5].
Full-potential versions of these band methods have also been introduced in recent years. However, none of these methods can match the power and versatility of a full-potential method based on the formalism of MST, either in terms of providing a complete solution of the SE or in the range of problems that could be treated. In particular, none of these methods leads easily to the construction of the Green's function, which is indispensable in the study of a number of properties of many physical systems.
Due to these reasons, in the last two decades, the KKR method has experienced a revival in the framework of the Green's function method (KKR-GF). Indeed, due to the introduction of the complex energy integration, it was found that the method is well suited for groundstate calculations, with an efficiency comparable to typical diagonalization methods. In this way a host of problems became tractable, ranging from solids with reduced symmetry (such as e.g. isolated impurities in ordered crystal, surfaces, interfaces, layered systems, etc) to randomly disordered alloys in the coherent potential approximation (CPA).
At the same time it soon became clear that the MT approximation was not adequate to the treatment of systems with reduced symmetry or for the calculation of lattice forces and relaxation. In order to deal with these problems a number of groups developed a full-potential (FP) KKR-GF method, obtaining very good results in the framework of the generalized-gradient approximation scheme (GGA), comparable with full-potential LAPW method (FLAPW), as far as concerned total energy calculations, lattice forces, relaxation around an impurity, ( [6,7] and references therein).
In this development the authors took an empirical attitude toward some fundamental problems related to the extension of MST to the full-potential case, such as the strongly debated question of the l-convergence of the theory or the need to converge 'internal' sums arising from the re-expansion of the free Green's function around two sites, which entails the unwanted feature of the introduction of rectangular matrices into the theory [8]. Without getting involved into ab initio questions, they just use square matrices for the structural Green's function G nn L L (E) needed to calculate the Green's function of the system (see e.g. equations ( 6) and ( 9) in [7]) and truncate the l-expansion to l max = 3 or 4, obtaining in this way the same accuracy as the FLAPW method. Some observations are in order at this point. First, the FP method in the framework of MST has been initially developed only for periodic systems in two or three dimensions and for states below the Fermi level. To our knowledge, its extension to treat bound and continuum states of polyatomic molecules and in general real space applications of the method have progressed very slowly and have been scarce. Secondly, the generation of the local solutions of the SE with truncated cells in the FP extension of the MST has up to now involved the expansion of the cell shape function in spherical harmonics, which might create convergence problems, as discussed below. Thirdly, the FP extension of MST has generated a lot of controversies that have gone on for more than thirty years [9]. Some of the problems have found a solution and we refer the reader to the book of Gonis and Butler [10] for a comprehensive review of the state of the art in this field (in particular see their chapter 6). However, questions such as the l-convergence of the theory or the use of square matrices are still a matter of debate and some rigorous answer should be given to them.
For all these reasons, applications to states well above the Fermi energy, as required in the simulations of x-ray spectroscopies, such as absorption, photo-emission, anomalous scattering, etc . . ., have been scarce.
The purpose of the present paper is the rigorous derivation of a real space FP-MST, valid both for continuum and bound states, that is free from the drawbacks hinted to above, in particular the need to use cell shape functions and rectangular matrices. In connection with this we shall present a new scheme to generate local basis functions for the truncated potential cells that is simple, fast, efficient, valid for any shape of the cell and reduces to the minimum the number of spherical harmonics in the expansion of the scattering wavefunction. Finally we shall also address the problem of the l-convergence of the theory, giving a positive answer to this debated question. A preliminary and partial account of this latter has been presented in [11].

Local basis functions for single truncated potential cells
A characteristic feature of MST is that it does not rely on a finite basis set for the expansion of the global wavefunction inside each cell as all other methods of electronic structure calculations do. Instead it relies on expanding the global solution in terms of local solutions of the Schrödinger equation at the energy of interest, which can be regarded as an optimally small, energy adapted basis set. Therefore it is essential for the practical implementation of the theory to devise an efficient numerical method to generate them. We shall consider Williams and Morgan (WM) basis functions L (r) [12] which inside each cell are local solutions of the SE and behave at the origin as J L (r) for r → 0. Throughout the paper we shall use real spherical harmonics and shall put for short J L (r; k) ≡ j l (kr )Y L (r), N L (r; k) ≡ n l (kr )Y L (r) and H + L (r; k) ≡ -ikh + l (kr )Y L (r), where j l , n l , h l denote respectively spherical Bessel, Neumann and Hankel functions of order l. The truncated cell potential V (r, r) is defined to coincide with the global system potential inside the cell and to be equal to zero (or to a constant) outside. As mentioned in the introduction we want to avoid the expansion of the truncated cell shape function (or equivalently of the truncated potential) in spherical harmonics due to convergence problems. However we observe that, even if the potential has a step, the wavefunction and its first derivative are continuous, so that its angular momentum (AM) expansion is well behaved and even converges uniformly in r [13]. Therefore we can safely write L (r) = L R L L (r )Y L (r) and this expression can be integrated term by term under integral sign.

Three-dimensional Numerov method
In order to generate the basis functions we write the SE in polar coordinates for the function P L (r) = r L (r)
where L2 is the angular momentum operator, whose action on P L (r, r) can be calculated as
Equation ( 1) in the variable r looks like a second order equation with an inhomogeneous term. Accordingly we use Numerov's method to solve it. As is well known, putting f L i, j = P L (r i , r j ) and dropping for simplicity the index L, the associated three point recursion relation is
where,
Here i is an index of radial mesh and j an index of angular points on a Lebedev surface grid [14]. Obviously
, where w j is the weight function for angular integration associated with the chosen grid. The number of surface points N Leb is given by N Leb ≈ (2l max + 1) 2 /3 as a function of the maximum angular momentum used [15], taking into account that one integrates the product of two spherical harmonics. Only the inhomogeneous term q i+1, j in the recurrence relation, containing the still unknown term f i+1, j , prevents us to solve the equation by iteration, from the knowledge of f i, j and f i-1, j at all the angular points. This difficulty is easily overcome by introducing the backward second derivative formula [16]
so that
The appearance of the third r derivative of q i , which is strictly infinite at the step point, does not cause practical problems.
Although not necessary, one can always assume a smoothing of the potential at the cell boundary à la Becke [17], reducing at the same time the mesh h, so that the error at that particular step point is negligible.
In this way, at the cost of a small error O(h 5 ) and the introduction of a further backward point (three points f i, j , f i-1, j and f i-2, j are now involved), the three-dimensional discretized equation can be solved along the radial direction for all angles in an onion-like way, provided the expansion ( 2) is performed at each new radial mesh point. We use a loglinear mesh ρ = αr + β ln r , to reduce numerical errors around the origin and the bounding sphere [18]. This modified Numerov method is much faster and requires a smaller memory space than the corresponding cell methods based on the shape function and/or the phase functions to generate the local solutions P L (r). Details are discussed in [19].
Figure 1 shows the comparison between the analytical solution and the numerical one for certain directions in the special case of the potential
Here V is given in Ryd, θ is the step function, R c = 3.78 au = 2.0 Å, the energy E = 0.3 Ryd, l max = 7 and the number of surface points on a Lebedev grid is 266.
It is easy to convince oneself that the above method for generating basis functions can also be used to solve the Poisson equation for the Coulomb potential, starting from a given charge density distribution partitioned on the same system of space-filling cells as the potential [19].

Multiple-scattering equation: scattering and bound states

Scattering states
We begin by presenting the derivation of MSE for scattering states. In this case we seek a solution of the SE continuous in the whole space with its first derivatives, satisfying the asymptotic boundary condition
where k is the photo-electron wavevector and f (r; k) is the scattering amplitude. The factor (k/16π 3 ) 1/2 takes into account the normalization of the scattering states to one state per Ryd. In the spirit of MST we partition the space in terms of non-overlapping space-filling cells j with surfaces S j and centers at R j . Accordingly we partition the overall space potential V (r) into cell potentials, such that V (r) = j v j (r j ), where v j (r j ) takes the value of V (r) for r inside cell j and vanishes elsewhere. (In reality, the zero value of the potential outside the cell is not necessary and can be replaced by any constant. The results will not depend on this particular value. However we shall deal here only with zero value.) Here and in the following r j = r -R j . The partition is assumed to satisfy the requirement that the shortest inter-cell vector R i j = R i -R j joining the origins of the nearest neighbors cells i and j , is larger than any intra-cell vector r i or r j , when r is inside cell i or cell j . If necessary, empty cells can be introduced to satisfy this requirement. We also assume that there exists a finite neighborhood around the origin of each cell lying in the domain of the cell [9]. We then start from the following identity involving surface integrals in dr ≡ dσ
Here o = j j , with surface S o , centered at the origin o and G + 0 (rr; k) is the free Green's function with outgoing wave boundary conditions satisfying the equation
where k 2 = E. This identity is valid for all r lying in the neighborhood of the origin of each cell, since in this case the integrands are continuous with their first derivatives.
For the convenience of the reader we recall the well known expansions [10]
The heart of MST is the introduction of the functions L (r j ; k) which inside cell j are local solutions of the SE with potential v j (r j ) behaving as J L (r j ; k) for r j → 0. They form a complete set of basis functions such that the global scattering wavefunction can be locally expanded as [9]
where we have underlined the k dependence of L (r j ; k) through its behavior at the origin.
In order to find the asymptotic behavior in the outer region C o we introduce the scattering functions ψ L (r o ; k) in response to an exciting wave of angular momentum L:
For the asymptotic behavior in the outer region C o , under the assumption of short range potentials (i.e. potentials that behave like 1/r 1+ with positive at great distances), letting r o → ∞ and using expansion (9) in equation (11) we find
where, in order to impose the asymptotic behavior in equation (5), In general for short range potentials decaying slowly, the asymptotic behavior in equation ( 12) is reached only at a great distance from the origin of the coordinates (usually at the center of the atomic cluster under study). In order to limit the number of cells, so that the surface S o just surrounds the cluster, we introduce the local solution
in the outer region C o , which can be obtained by inward integration of the SE starting from the appropriate asymptotic value H + L (r o ; k). Therefore we take here
Notice that the function L (r o ; k) in equation ( 13) (and consequently R o L L (r o )) is complex, unlike the functions L (r i ; k) that can be taken real, if the potential is real. If the potential has a Coulomb tail, the spherical Bessel and Hankel functions should be replaced by the corresponding regular and irregular solutions F L (r o ; k) and G L (r o ; k) of the radial SE with a Coulomb potential.
Insertion of the expressions ( 10) and ( 14) into the identity (6) provides a set of algebraic equations (known as MSE) that determine the expansion coefficients A j L (k) and the A o L (k) in such a way that the local representations are smoothly continuous across the common boundary of contiguous cells. Indeed, taking r in the neighborhood of the origin of cell i = o, using the expansion (8) (since r is confined to lie on the cell surfaces), and putting to zero the coefficients of J L (r i ; k) due to their linear independence, we readily arrive at the MST compatibility equations for the amplitudes
where
A further set equation is obtained by taking r inside the outer region C o , using the expansion (9) (remembering that r o < r o , since r o lies on S o ). By putting to zero the coefficients of
where
From the above derivation it is clear that the set of equations ( 15) and ( 16
where G i j L L are the free electron propagator in the site and angular momentum basis (KKR real space structure factors) given by
and J i j L L is the translation operator
In these formulae the quantities C(L, L ; L ) are the real basis Gaunt coefficients given by
In the following we shall also need the quantity
The re-expansions series ( 17), ( 18) and ( 19) are known to be absolutely convergent under the indicated conditions. Unfortunately they introduce further expansion parameters into the theory (with related convergence problems) that are actually unnecessary, as shown below.
We in fact observe that the integrals over the surfaces of the various cells j can be calculated over the surfaces of the corresponding bounding spheres (with radius R j b ) by application of the Green's theorem, since both H + L (r; k) and L (r; k) satisfy the Helmholtz equation (∇ 2 + k 2 )F(r) = 0 outside the domain of the cell. We then use the following relations
) which are exact for all L provided |r ir j | = R i j > r j for r lying on the surface S j . This is a consequence of the fact that under this condition the series in equation ( 17) converges absolutely. By use of the Weierstrass criterion, it is also uniformly convergent in the entire solid angle domain and can therefore be integrated term by term [21] (this property is also true for the series derived with respect to r).
We get similar relations for the other two expansions simply by replacing G i j L L by J i j L L for re-expansion (18). For re-expansion (19) we instead replace
. By inserting in equation ( 15) the expression for the basis functions expanded in spherical harmonics (we shall suppress the site indices whenever a relation refers to both sites i and site o)
and using the relations ( 24), ( 25) and similar we finally obtain
In the above equations we have defined the quantities
for the cells j and for the outer region C o . The Wronskians W [ f, g] = f gg f are calculated at R j b and R o b respectively and reduce to diagonal matrices for MT potentials. In order to derive these MS equations we have used the identity
and the relation
which is obtained from equation ( 21) by observing that
Equations ( 27) and ( 28) look formally similar to the usual MSE. However we notice that due to the relations ( 24)- (25) and the similar there are only two expansion parameters in the theory. They are related to the AM components of R L L in the expansion (26) in cell j and in the outer region C o . No convergence constraints related to the re-expansion of the various Bessel and Hankel functions around a different origin ( 17)-( 19) are present.
It is interesting to note that the truncation value for both indices is the same and corresponds to the classical relation l max = k R j b , where R j b is the radius of the bounding sphere of the cell at site j . This is true for the index L, which reminds us that the basis function L is normalized like j l (kr )Y L near the origin. Due to the properties of the Bessel functions, when l k R j b , L becomes very small inside the cell, decreasing like [(2l + 1)!!] -1 . Therefore its weight in the expansion (26) will be negligible. The other index L , as will be clear from the following, measures the response of the truncated potential inside the cell to an incident wave J L of angular momentum L . Due to the same argument as above, familiar to scattering theory, the scattering matrix T j L L will decrease like [(2l +1)!!(2l +1)!!] -1 . As a consequence E j and S j can be considered square matrices. In the case of the outer sphere region C o , the situation is inverted, the index L being related to the response of the entire cluster to an incident wave of angular momentum L, whereas the index L corresponds to the number of AM waves mixed in by the potential, not only inside o but also in C o . The two indices have the same truncation l max = k Ro b , provided we take Ro b as the radius of the sphere that contains the region of space where the potential is substantially different from zero. This conclusion is reinforced by the observation that one can cover this same region only by atomic and empty cells.
The fact that E and S can be taken to be square matrices leads to another interesting form of the MSE. Under the assumption that DetS = 0, we can introduce new amplitudes
which is equivalent to using new basis functions L related to L by the relation
where S is the transpose of the matrix S. Defining the quantities
(notice the asymmetry between sites i and site o) we can write equations ( 27) and (28) as
The meaning of the amplitudes B L (k) is immediately found from these equations if we consider only a single truncated potential at center i , i.e. if we put G i j L L ≡ 0. It is the scattering amplitude of angular momentum L in response to an exciting plane wave of wavevector k.
In the case of many cells, it is expedient to work only in terms of the cell amplitudes B i L (k). Inserting into equation (37) the expression for B o L (k) given by equation (38) we obtain
Introducing τ , the inverse of the multiple-scattering matrix
known as the scattering path operator [10], we derive from equation (39) that
If we insert this expression in equation ( 38) and remember that by definition
Ão L , we easily find for the cluster T -matrix
Since the matrices G and J are also symmetric (see definitions (20) and ( 21)), we find that τ is likewise symmetric, implying the symmetry of T o L L , again in keeping with scattering theory. This quantity indeed represents for the whole cluster the scattering amplitude into a spherical wave of angular momentum L in response to an exciting wave of AM L and is needed for example in electron molecular scattering [22]. Finally equation (41) shows that the quantities B i L (k) are scattering amplitudes for the cluster, for which the generalized optical theorem holds (for real potentials) [20,22]
This relation is very important, since it establishes the connection between the photo-emission and the photoabsorption cross section, as illustrated below. As it will turn out, -Im τ ii L L is proportional to the L-projected density of states onto site i .

Bound states
The MSE in the case of bound states can be derived from those for scattering states, by simply eliminating the exciting plane wave in equation ( 5) and taking the analytical continuation to negative energies in the free Green's function G + 0 (rr; k), in order to impose the boundary condition of decaying waves when r → ∞. In this case the Lippmann-Schwinger equation reduces to the eigenvalue equation
where we have dropped the label k in the wavefunction ψ(r ).
Since the expansion of G + 0 (rr; k) in terms of Bessel and Hankel functions in equations ( 8) and ( 9) remains valid under the analytical continuation to negative energies, so that k = √ E = i √ |E| = i γ , we see that ψ(r ) behaves like e ikr /r = e -γ r /r for r → ∞. We recall that
(45) where I l is the modified spherical Bessel and K 1 l , K 2 l the modified Hankel functions of first and second kind, respectively. Not only the expansions in equations ( 8) and ( 9), but also the re-expansion relations in equations ( 17)-( 19) remain valid under analytical continuation with the same convergence properties. This fact implies that we can derive the MSE for bound states following the same patterns as for scattering states, except that now the behavior of the wavefunction in the outer region
The functions o L (r o ) are now real and can easily be found by inward integration in the outer region starting from an asymptotic WKB solution properly normalized, e.g. like
Working with the B L amplitudes we easily arrive at the following condition for the existence of a bound state
which is the same as equation ( 39), except that the exciting plane wave term I i L (k) and the k dependence has been dropped. Notice that we have kept the arbitrariness of V 0 in the free Green's function, in order to check that the eigenvalues do not depend on it. In the spirit of the analytical continuation, we have a definite rule on how to calculate the various quantities as a function of k.
We now define
so that, remembering equation ( 36)
Moreover we observe that
Table 1. Eigenvalues of the hydrogen molecular ion (in Ryd) [19].

Mol. orb. n l m Exact
Smith and Johnson [23] Foulis [24] 22 EC V 0 = -1.90  where N i j L L is defined in equation ( 23) and that L J io L L J oj L L = J i j L L , since J is the translational operator. Substituting these relations into equation (47) and eliminating the common factor k -1 we finally find j L
The generic (L L )-element of this MS matrix is either real for real k (E > 0) or proportional to i l-l +1 for imaginary k (E < 0). Indeed, due to the relations (45), putting for short
, we easily find that
where C and S are defined in terms of the modified Bessel and Neumann functions as the corresponding quantities. Therefore the condition for a bound state becomes DetM = 0, where M is the MS matrix in equation (52) after a unitary transformation that eliminates the imaginary factors.
We applied the theory above to find the exact eigenvalues of the hydrogen molecular ion. In this case we partition the space into three regions, as illustrated in figure 2, two truncated spheres around the protons with a radius of 1.72 au corresponding to cells I and II and an external region labeled III , corresponding to the complementary domain C o . The bounding sphere of this latter is represented by the dashed circle with radius 1.4 au, larger than one half the distance of the protons. By calling the region outside this circle C b , the potential is taken to be zero (or constant) into the intersection of this domain with cells I and II , and equal to the value of the true potential in the intersection with C o . We also did a calculation with the two atomic cells, 22 empty cells surrounding them, plus an external region.
Our findings are listed into table 1 and compared with the exact results. The last two columns show the eigenvalues obtained with two different values of V 0 , respectively equal to -1.90 Ryd and 0, showing the independence of the results from the constant interstitial value V 0 . The columns with the label '22 EC' refer to the calculation with two atomic cells, 22 empty cells and an external region, showing the independence of the result from the partitioning mode of the space. The column labeled 'Smith and Johnson' refers to the calculation by Smith and Johnson [23] in the MT approximation, whereas the one labeled 'Foulis' quotes the result by Foulis [24] obtained with the distorted wave approximation.

Spectroscopic response functions
Having found an expression for the scattering states, we are now in a position to write down the response functions for various spectroscopies. The detailed derivation is given in [25].
In the independent electron approximation, the core level photo-electron diffraction (PED) cross section for the ejection of a photo-electron along the direction k and energy E = k 2 from an atom situated at site i is given by dσ
Here is the time-reversal operator, ε the polarization of the incident photon and φ c L c (r i ) the initial core state of angular momentum L c (we neglect for simplicity the spin-orbit coupling, which can be easily taken into account). Due to the localization of the core state, we need only the expression of the continuum scattering state in the cell of the photoabsorber, given by ψ(
where B i L (k) is given by equation (41) and we have defined the atomic transition matrix element
The total absorption cross section, in the case of real potentials, is obtained by integrating the PED cross section over all directions of photo-emission
by application of the optical theorem (43). This is the form of the absorption cross section that one would obtain starting from its expression in terms of the Green's Function (GF)
Indeed, for general (possibly complex) potentials, the GF of the cluster can be written as [10,26]
where r < (r > ) indicates the lesser (the greater) between r i and r i . The function (r) is the irregular solution in cell i that matches smoothly to H + L (r) at R i b . For short we have represented the sum over the angular momentum indices with a bra and ket notation (e.g.)
(60)
Moreover, for simplicity of derivation we have assumed no contribution from the outer region potential (i.e. T o ≡ 0) allowing empty cells to cover the volume o up to the point at which the asymptotic behavior in equation (12) starts to be valid. The modifications needed in the case T o = 0 are obvious. Now, from the relation
by continuity we derive inside cell i the relation
where L (r i ) is the irregular function joining smoothly to
Therefore the Green's function takes the form
For real potentials, both L and L are real, so that equation (58) reduces to equation (57). In this case the quantity i G(r, r;
L d 3 r is the projected density of states on site i at energy E, expressed as a sum of the partial densities of type L.

Applications
We have tested the present FP-MS scheme against the analytical solution of the absorption cross section for hydrogen-like atoms given by [27]
1e -2π Z k in the case of the Li 2+ atom (Z = 3). Even though the potential is spherically symmetric in the whole space with respect to the atomic center so that it is easy to reproduce numerically the cross section, this is not obvious in the MS scheme.
To this purpose we have partitioned the space inside a sphere of radius R = 8.6 au into an atomic sphere of 4.15 au and 14 other empty spheres, all truncated so that the resulting polyhedra do not overlap and such that their bounding spheres do not overlap more than 40%. To calculate the contribution of the outer sphere we integrated inwardly the Coulomb potential. Figure 3 shows the almost exact agreement between the analytical and the numerical result, indicating that the partitioning procedure for solving the SE is able to reconstruct the global solution. Moreover the oscillations due to the truncation of the potential inside each cell (shown by the solution for a truncated central sphere with radius 4.15 au) Figure 4(a) shows an application of the method to the calculation of the Ge K-edge absorption spectrum of the tetrahedral molecule GeCl 4 [28]. The MT approximation could never reproduce the first bump after the main transition. Its appearance is due to the introduction of the anisotropy of the potential inside the atoms and the presence of four empty Voronoi cells completing the BCC unit cell. An l max = 4 was sufficient to reach convergence of the spectrum, as verified by using higher l values up to l max = 10 (figure 4(b)).
Then we show the application of the present FP-MS theory to two cases which, according to our experience, need significant non-MT corrections for a good reproduction of the absorption data: diatomic (and in general linear) molecules and tetrahedrally coordinated compounds.
The first example is illustrated in figure 5, showing the experimental unpolarized K-edge absorption cross section of the diatomic molecule Se 2 [29,30] together with an NMT and an MT calculation. For the NMT case we partitioned the space with 24 Voronoi polyhedra arranged on a BCC lattice: two of them around the physical atoms and 22 empty cells (EC) to cover the rest of the space where the density (and the potential) are significantly different from zero. We gave a finite imaginary to the energy of the order of the experimental resolution (1.0 eV) in order to be able to use the same Green's function expression for the cross section (58) both for bound and continuum states. The energy zero in the figure corresponds to the onset of the continuum. Below it there are two unoccupied empty states, at energies approximately -5 and -7 eV. To calculate the absorption spectrum, we used the real part of an Hedin-Lundqvist (HL) potential and then convolved the result with a Lorentzian whose width is equal to the that of the core hole (2.33 eV). A similar calculation without empty cells gave substantially the same result. We see that the agreement with experiment is reasonably good, apart from the intensity of the first bound state that is higher than the second. Using an X α potential corrects for this discrepancy but worsens the agreement around the minimum, which turns out to much shallower. This is a typical case in which the NMT approach is useful for the study of the effective optical potential, since there are no other approximations in the theory. In contrast, the MT approximation of the potential turns out to be rather poor, since in this case the second bound state is pushed up toward the continuum threshold.
The second example concerns the L 2,3 edge of crystalline SiO 2 (α-quartz). The MT approximation in tetrahedrally coordinated materials is usually not satisfactory, due to the bad representation of the anisotropy of the potential in the interstitial region, as already found in the case of GeCl 4 [11]. Figure 6 shows the comparison between the MT and NMT calculations against the experimental data, obtained by an electron energy loss technique [31]. We used a complex HL potential and a 5 Å cluster, composed of 49 atomic cells, containing 19 Si and 30 O, and 22 empty cells (EC), in total 71 cells. In order to obtain the first peak it was essential to include four EC in the first coordination shell, a feature already observed in GeCl 4 , although better details were obtained with further inclusions of EC. We also checked the convergence of the calculated spectrum with the size of the cluster, up to 10 Å, obtaining the splitting of the first peak, as observed experimentally, and rather similar features for the rest of the spectrum. This finding confirms the fairly localized nature of the final 3d states in this compound. No experimental resolution (0.5 eV) was taken into account beyond the damping due to the imaginary part of the HL potential. More details will be given elsewhere.

Conclusions
We have developed an FP-MS scheme which is a straightforward generalization of the usual theory with MT potentials and implemented the code to calculate cross sections for several spectroscopies, such as absorption, photo-electron diffraction and anomalous scattering, as well as bound states, by a simple analytical continuation. The key point in this approach is the generation of the cell solutions L (r) for a general truncated potential free of the well known convergence problems of AM expansion together with an alternative derivation of the MSE which allows us to treat the matrices S and E as square, with only one truncation parameter, given by the classical relation l max ∼ k R b . The fact that the theory can work with square S and E matrices is of the utmost importance, since this feature allows the definition of the cell T matrix and its inverse, reviving in such a way the possibility to define the Green's function and to treat a host of problems, ranging from solids with reduced symmetry to randomly disordered alloys in the context of the CPA, as mentioned in the introduction. In this way one can also show that the wavefunction and the Green's function approach provide the same expression for the absorption cross section for continuum states and real potentials, through the application of the generalized optical theorem (43). For transitions to bound states the two methods are not equivalent, due to the different normalization of continuum and bound states, unless one normalizes the wavefunctions for these to one. However this procedure, although feasible, is rather cumbersome (this was one of the reasons for abandoning the MS method in favor of the simpler linearized methods in band-structure calculations). In this case the Green's function expression for the cross section (58) can be used, since it gives the correct normalization in both cases simply by analytical continuation. We have exploited this fact when calculating the cross section for the Se 2 diatomic molecule.
Moreover, in [19], we have been able to show that the FP-MST converges absolutely in the l max → ∞ limit. We have thus given a firm ground to its use as a viable method for electronic structure calculation ( [6,7] and references therein) and at the same time have provided a straightforward extension of MST in the muffin-tin (MT) approximation for the calculation of x-ray spectroscopies. Also Quantum Chemistry calculations might benefit from this method in that it avoids the use of basis function sets.
Finally it is worth mentioning that in giving a new scheme to generate local basis functions for truncated potential cells, we have provided an efficient and fast method for solving numerically a partial differential equation of the elliptic type in polar coordinates, which can also be used to solve the Poisson equation in the whole space by the partitioning method.
