Introduction:
Multiple-scattering theory (MST) is a technique for solving a linear partial differential equation over a region of space with certain boundary conditions. It is implemented by dividing the space into non-overlapping domains (cells), solving the differential equation separately in each of the cells and then assembling together the partial solutions into a global solution that is continuous and smooth across the whole region and satisfies the given boundary conditions.As such, MST has been applied to the solution of many problems drawn both from classical as well as quantum physics, ranging from the study of membranes and electromagnetism to the quantum-mechanical wave equation. In quantum mechanics it has been widely used to solve the Schrödinger equation (SE) (or the associated Lippmann-Schwinger equation (LSE)) both for scattering and bound states. It was proposed originally by Korringa and by Kohn and Rostoker (KKR) as a convenient method for calculating the electronic structure of solidsApplications of the KKR method were first made within the so-called muffin-tin (MT) approximation for the potential. In this approximation the potential is confined within nonoverlapping spheres, where it is spherically symmetrized, and takes a constant value in the interstitial region. Moreover, although spherical symmetry is not formally necessary, the condition that the bounding spheres do not overlap was thought to be necessary for the validity of the theory. Despite this approximation the method is complicated and demanding from a numerical point of view and as a band-structure method it was therefore superseded by more efficient linearized methods, such as the linearized muffin-tin-orbital method (LMTO)Full-potential versions of these band methods have also been introduced in recent years. However, none of these methods can match the power and versatility of a full-potential method based on the formalism of MST, either in terms of providing a complete solution of the SE or in the range of problems that could be treated. In particular, none of these methods leads easily to the construction of the Green's function, which is indispensable in the study of a number of properties of many physical systems.Due to these reasons, in the last two decades, the KKR method has experienced a revival in the framework of the Green's function method (KKR-GF). Indeed, due to the introduction of the complex energy integration, it was found that the method is well suited for groundstate calculations, with an efficiency comparable to typical diagonalization methods. In this way a host of problems became tractable, ranging from solids with reduced symmetry (such as e.g. isolated impurities in ordered crystal, surfaces, interfaces, layered systems, etc) to randomly disordered alloys in the coherent potential approximation (CPA).At the same time it soon became clear that the MT approximation was not adequate to the treatment of systems with reduced symmetry or for the calculation of lattice forces and relaxation. In order to deal with these problems a number of groups developed a full-potential (FP) KKR-GF method, obtaining very good results in the framework of the generalized-gradient approximation scheme (GGA), comparable with full-potential LAPW method (FLAPW), as far as concerned total energy calculations, lattice forces, relaxation around an impurity, (In this development the authors took an empirical attitude toward some fundamental problems related to the extension of MST to the full-potential case, such as the strongly debated question of the l-convergence of the theory or the need to converge 'internal' sums arising from the re-expansion of the free Green's function around two sites, which entails the unwanted feature of the introduction of rectangular matrices into the theoryFor all these reasons, applications to states well above the Fermi energy, as required in the simulations of x-ray spectroscopies, such as absorption, photo-emission, anomalous scattering, etc . . ., have been scarce.The purpose of the present paper is the rigorous derivation of a real space FP-MST, valid both for continuum and bound states, that is free from the drawbacks hinted to above, in particular the need to use cell shape functions and rectangular matrices. In connection with this we shall present a new scheme to generate local basis functions for the truncated potential cells that is simple, fast, efficient, valid for any shape of the cell and reduces to the minimum the number of spherical harmonics in the expansion of the scattering wavefunction. Finally we shall also address the problem of the l-convergence of the theory, giving a positive answer to this debated question. A preliminary and partial account of this latter has been presented in

Local basis functions for single truncated potential cells:
A characteristic feature of MST is that it does not rely on a finite basis set for the expansion of the global wavefunction inside each cell as all other methods of electronic structure calculations do. Instead it relies on expanding the global solution in terms of local solutions of the Schrödinger equation at the energy of interest, which can be regarded as an optimally small, energy adapted basis set. Therefore it is essential for the practical implementation of the theory to devise an efficient numerical method to generate them. We shall consider Williams and Morgan (WM) basis functions L (r)

Three-dimensional Numerov method:
In order to generate the basis functions we write the SE in polar coordinates for the function P L (r) = r L (r)where L2 is the angular momentum operator, whose action on P L (r, r) can be calculated asEquation (where,Here i is an index of radial mesh and j an index of angular points on a Lebedev surface grid, where w j is the weight function for angular integration associated with the chosen grid. The number of surface points N Leb is given by N Leb ≈ (2l max + 1) 2 /3 as a function of the maximum angular momentum usedso thatThe appearance of the third r derivative of q i , which is strictly infinite at the step point, does not cause practical problems.Although not necessary, one can always assume a smoothing of the potential at the cell boundary à la BeckeIn this way, at the cost of a small error O(h 5 ) and the introduction of a further backward point (three points f i, j , f i-1, j and f i-2, j are now involved), the three-dimensional discretized equation can be solved along the radial direction for all angles in an onion-like way, provided the expansion (FigureHere V is given in Ryd, θ is the step function, R c = 3.78 au = 2.0 Å, the energy E = 0.3 Ryd, l max = 7 and the number of surface points on a Lebedev grid is 266.It is easy to convince oneself that the above method for generating basis functions can also be used to solve the Poisson equation for the Coulomb potential, starting from a given charge density distribution partitioned on the same system of space-filling cells as the potential

Scattering states:
We begin by presenting the derivation of MSE for scattering states. In this case we seek a solution of the SE continuous in the whole space with its first derivatives, satisfying the asymptotic boundary conditionwhere k is the photo-electron wavevector and f (r; k) is the scattering amplitude. The factor (k/16π 3 ) 1/2 takes into account the normalization of the scattering states to one state per Ryd. In the spirit of MST we partition the space in terms of non-overlapping space-filling cells j with surfaces S j and centers at R j . Accordingly we partition the overall space potential V (r) into cell potentials, such that V (r) = j v j (r j ), where v j (r j ) takes the value of V (r) for r inside cell j and vanishes elsewhere. (In reality, the zero value of the potential outside the cell is not necessary and can be replaced by any constant. The results will not depend on this particular value. However we shall deal here only with zero value.) Here and in the following r j = r -R j . The partition is assumed to satisfy the requirement that the shortest inter-cell vector R i j = R i -R j joining the origins of the nearest neighbors cells i and j , is larger than any intra-cell vector r i or r j , when r is inside cell i or cell j . If necessary, empty cells can be introduced to satisfy this requirement. We also assume that there exists a finite neighborhood around the origin of each cell lying in the domain of the cellHere o = j j , with surface S o , centered at the origin o and G + 0 (rr; k) is the free Green's function with outgoing wave boundary conditions satisfying the equationwhere k 2 = E. This identity is valid for all r lying in the neighborhood of the origin of each cell, since in this case the integrands are continuous with their first derivatives.For the convenience of the reader we recall the well known expansionsThe heart of MST is the introduction of the functions L (r j ; k) which inside cell j are local solutions of the SE with potential v j (r j ) behaving as J L (r j ; k) for r j → 0. They form a complete set of basis functions such that the global scattering wavefunction can be locally expanded aswhere we have underlined the k dependence of L (r j ; k) through its behavior at the origin.In order to find the asymptotic behavior in the outer region C o we introduce the scattering functions ψ L (r o ; k) in response to an exciting wave of angular momentum L:For the asymptotic behavior in the outer region C o , under the assumption of short range potentials (i.e. potentials that behave like 1/r 1+ with positive at great distances), letting r o → ∞ and using expansionwhere, in order to impose the asymptotic behavior in equationis the T -matrix for the whole cluster.In general for short range potentials decaying slowly, the asymptotic behavior in equation (in the outer region C o , which can be obtained by inward integration of the SE starting from the appropriate asymptotic value H + L (r o ; k). Therefore we take hereNotice that the function L (r o ; k) in equation (Insertion of the expressions (whereA further set equation is obtained by taking r inside the outer region C o , using the expansion (9) (remembering that r o < r o , since r o lies on S o ). By putting to zero the coefficients ofwhereFrom the above derivation it is clear that the set of equations (where G i j L L are the free electron propagator in the site and angular momentum basis (KKR real space structure factors) given byand J i j L L is the translation operatorIn these formulae the quantities C(L, L ; L ) are the real basis Gaunt coefficients given byIn the following we shall also need the quantityThe re-expansions series (We in fact observe that the integrals over the surfaces of the various cells j can be calculated over the surfaces of the corresponding bounding spheres (with radius R j b ) by application of the Green's theorem, since both H + L (r; k) and L (r; k) satisfy the Helmholtz equation (∇ 2 + k 2 )F(r) = 0 outside the domain of the cell. We then use the following relations) which are exact for all L provided |r ir j | = R i j > r j for r lying on the surface S j . This is a consequence of the fact that under this condition the series in equation (We get similar relations for the other two expansions simply by replacing G i j L L by J i j L L for re-expansion. By inserting in equation (and using the relations (In the above equations we have defined the quantitiesfor the cells j and for the outer region C o . The Wronskians W [ f, g] = f gg f are calculated at R j b and R o b respectively and reduce to diagonal matrices for MT potentials. In order to derive these MS equations we have used the identityand the relationwhich is obtained from equation (Equations (It is interesting to note that the truncation value for both indices is the same and corresponds to the classical relation l max = k R j b , where R j b is the radius of the bounding sphere of the cell at site j . This is true for the index L, which reminds us that the basis function L is normalized like j l (kr )Y L near the origin. Due to the properties of the Bessel functions, when l k R j b , L becomes very small inside the cell, decreasing like [(2l + 1)!!] -1 . Therefore its weight in the expansion (26) will be negligible. The other index L , as will be clear from the following, measures the response of the truncated potential inside the cell to an incident wave J L of angular momentum L . Due to the same argument as above, familiar to scattering theory, the scattering matrix T j L L will decrease like [(2l +1)!!(2l +1)!!] -1 . As a consequence E j and S j can be considered square matrices. In the case of the outer sphere region C o , the situation is inverted, the index L being related to the response of the entire cluster to an incident wave of angular momentum L, whereas the index L corresponds to the number of AM waves mixed in by the potential, not only inside o but also in C o . The two indices have the same truncation l max = k Ro b , provided we take Ro b as the radius of the sphere that contains the region of space where the potential is substantially different from zero. This conclusion is reinforced by the observation that one can cover this same region only by atomic and empty cells.The fact that E and S can be taken to be square matrices leads to another interesting form of the MSE. Under the assumption that DetS = 0, we can introduce new amplitudeswhich is equivalent to using new basis functions L related to L by the relationwhere S is the transpose of the matrix S. Defining the quantities(notice the asymmetry between sites i and site o) we can write equations (The meaning of the amplitudes B L (k) is immediately found from these equations if we consider only a single truncated potential at center i , i.e. if we put G i j L L ≡ 0. It is the scattering amplitude of angular momentum L in response to an exciting plane wave of wavevector k.In the case of many cells, it is expedient to work only in terms of the cell amplitudes B i L (k). Inserting into equation (37) the expression for B o L (k) given by equation (38) we obtainIntroducing τ , the inverse of the multiple-scattering matrixknown as the scattering path operatorIf we insert this expression in equation (Ão L , we easily find for the cluster T -matrixSince the matrices G and J are also symmetric (see definitionsThis relation is very important, since it establishes the connection between the photo-emission and the photoabsorption cross section, as illustrated below. As it will turn out, -Im τ ii L L is proportional to the L-projected density of states onto site i .

Bound states:
The MSE in the case of bound states can be derived from those for scattering states, by simply eliminating the exciting plane wave in equation (where we have dropped the label k in the wavefunction ψ(r ).Since the expansion of G + 0 (rr; k) in terms of Bessel and Hankel functions in equations ((45) where I l is the modified spherical Bessel and K 1 l , K 2 l the modified Hankel functions of first and second kind, respectively. Not only the expansions in equations (The functions o L (r o ) are now real and can easily be found by inward integration in the outer region starting from an asymptotic WKB solution properly normalized, e.g. likeWorking with the B L amplitudes we easily arrive at the following condition for the existence of a bound statewhich is the same as equation (We now defineso that, remembering equation (Moreover we observe thatTable

Mol. orb. n l m Exact:
Smith and Johnson205 25 -2.071 6 -2.189 73 -2.205 22 -2.2055 -2.2050 -2.2048 2a 1g 2 0 0 -0.721 73 -0.707 38 -0.720 93 -0.723 -0.724 -0.731 -0.726 3a 1g 3 2 0 -0.471 55 -0.455 74 -0.471 02 -0.472 7 -0.478 -0.476 -0.474 4a 1g 3 0 0 -0.355 36 -0.348 59 -0.355 25 -0.356 -0.3550 -0.357 -0.356 1a 2u 2 1 0 -1.335 07 -1.286 8 -1.334 26 -1.334 8 -1.3348 -1.3342 -1.3343 2a 2u 3 1 0 -0.510 83 -0.497 22 -0.510 85 -0.510 72 -0.5105 -0.5104 -0.5104 3a 2u 4 1 0 -0.274 63 -0.269 79 -0.274 66 -0.274 69 -0.2742 -0.2745 -0.2745 4a 2u 4 3 0 -0.253 29 -0.249 97 -0.253 29 -0.254 -0.2536 -0.2541 -0.253 01 1e 1g 3 2 1 -0.453 40 -0.446 46 -0.453 33 -0.4545 -0.453 32 -0.455 -0.455 1e 1u 2 1 1 -0.857 55 -0.888 66 -0.855 85 -0.857 54 -0.856 1 -0.870 -0.858 where N i j L L is defined in equation (The generic (L L )-element of this MS matrix is either real for real k (E > 0) or proportional to i l-l +1 for imaginary k (E < 0). Indeed, due to the relations (45), putting for short, we easily find thatwhere C and S are defined in terms of the modified Bessel and Neumann functions as the corresponding quantities. Therefore the condition for a bound state becomes DetM = 0, where M is the MS matrix in equation (52) after a unitary transformation that eliminates the imaginary factors.We applied the theory above to find the exact eigenvalues of the hydrogen molecular ion. In this case we partition the space into three regions, as illustrated in figureOur findings are listed into table 1 and compared with the exact results. The last two columns show the eigenvalues obtained with two different values of V 0 , respectively equal to -1.90 Ryd and 0, showing the independence of the results from the constant interstitial value V 0 . The columns with the label '22 EC' refer to the calculation with two atomic cells, 22 empty cells and an external region, showing the independence of the result from the partitioning mode of the space. The column labeled 'Smith and Johnson' refers to the calculation by Smith and Johnson

Spectroscopic response functions:
Having found an expression for the scattering states, we are now in a position to write down the response functions for various spectroscopies. The detailed derivation is given inIn the independent electron approximation, the core level photo-electron diffraction (PED) cross section for the ejection of a photo-electron along the direction k and energy E = k 2 from an atom situated at site i is given by dσHere is the time-reversal operator, ε the polarization of the incident photon and φ c L c (r i ) the initial core state of angular momentum L c (we neglect for simplicity the spin-orbit coupling, which can be easily taken into account). Due to the localization of the core state, we need only the expression of the continuum scattering state in the cell of the photoabsorber, given by ψ(where B i L (k) is given by equation (41) and we have defined the atomic transition matrix elementThe total absorption cross section, in the case of real potentials, is obtained by integrating the PED cross section over all directions of photo-emissionby application of the optical theorem (43). This is the form of the absorption cross section that one would obtain starting from its expression in terms of the Green's Function (GF)Indeed, for general (possibly complex) potentials, the GF of the cluster can be written aswhere r < (r > ) indicates the lesser (the greater) between r i and r i . The function (r) is the irregular solution in cell i that matches smoothly to H + L (r) at R i b . For short we have represented the sum over the angular momentum indices with a bra and ket notation (e.g.)(60)Moreover, for simplicity of derivation we have assumed no contribution from the outer region potential (i.e. T o ≡ 0) allowing empty cells to cover the volume o up to the point at which the asymptotic behavior in equationby continuity we derive inside cell i the relationwhere L (r i ) is the irregular function joining smoothly toTherefore the Green's function takes the formFor real potentials, both L and L are real, so that equation (58) reduces to equation (57). In this case the quantity i G(r, r;L d 3 r is the projected density of states on site i at energy E, expressed as a sum of the partial densities of type L.

Applications:
We have tested the present FP-MS scheme against the analytical solution of the absorption cross section for hydrogen-like atoms given by1e -2π Z k in the case of the Li 2+ atom (Z = 3). Even though the potential is spherically symmetric in the whole space with respect to the atomic center so that it is easy to reproduce numerically the cross section, this is not obvious in the MS scheme.To this purpose we have partitioned the space inside a sphere of radius R = 8.6 au into an atomic sphere of 4.15 au and 14 other empty spheres, all truncated so that the resulting polyhedra do not overlap and such that their bounding spheres do not overlap more than 40%. To calculate the contribution of the outer sphere we integrated inwardly the Coulomb potential. FigureFigureThen we show the application of the present FP-MS theory to two cases which, according to our experience, need significant non-MT corrections for a good reproduction of the absorption data: diatomic (and in general linear) molecules and tetrahedrally coordinated compounds.The first example is illustrated in figureThe second example concerns the L 2,3 edge of crystalline SiO 2 (α-quartz). The MT approximation in tetrahedrally coordinated materials is usually not satisfactory, due to the bad representation of the anisotropy of the potential in the interstitial region, as already found in the case of GeCl 4

Conclusions:
We have developed an FP-MS scheme which is a straightforward generalization of the usual theory with MT potentials and implemented the code to calculate cross sections for several spectroscopies, such as absorption, photo-electron diffraction and anomalous scattering, as well as bound states, by a simple analytical continuation. The key point in this approach is the generation of the cell solutions L (r) for a general truncated potential free of the well known convergence problems of AM expansion together with an alternative derivation of the MSE which allows us to treat the matrices S and E as square, with only one truncation parameter, given by the classical relation l max ∼ k R b . The fact that the theory can work with square S and E matrices is of the utmost importance, since this feature allows the definition of the cell T matrix and its inverse, reviving in such a way the possibility to define the Green's function and to treat a host of problems, ranging from solids with reduced symmetry to randomly disordered alloys in the context of the CPA, as mentioned in the introduction. In this way one can also show that the wavefunction and the Green's function approach provide the same expression for the absorption cross section for continuum states and real potentials, through the application of the generalized optical theorem (43). For transitions to bound states the two methods are not equivalent, due to the different normalization of continuum and bound states, unless one normalizes the wavefunctions for these to one. However this procedure, although feasible, is rather cumbersome (this was one of the reasons for abandoning the MS method in favor of the simpler linearized methods in band-structure calculations). In this case the Green's function expression for the cross section (58) can be used, since it gives the correct normalization in both cases simply by analytical continuation. We have exploited this fact when calculating the cross section for the Se 2 diatomic molecule.Moreover, inFinally it is worth mentioning that in giving a new scheme to generate local basis functions for truncated potential cells, we have provided an efficient and fast method for solving numerically a partial differential equation of the elliptic type in polar coordinates, which can also be used to solve the Poisson equation in the whole space by the partitioning method.

